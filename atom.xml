<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>菜鹌鹑</title>
  
  <subtitle>薄命长辞知己别，问人生，到处凄凉否。</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://quail2333.github.io/"/>
  <updated>2019-08-15T03:00:50.286Z</updated>
  <id>http://quail2333.github.io/</id>
  
  <author>
    <name>Quail</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>MySQL报make  [all] Error 2</title>
    <link href="http://quail2333.github.io/2019/08/15/MySQL%E6%8A%A5make%20%20%5Ball%5D%20Error%202/"/>
    <id>http://quail2333.github.io/2019/08/15/MySQL报make  [all] Error 2/</id>
    <published>2019-08-14T16:00:00.000Z</published>
    <updated>2019-08-15T03:00:50.286Z</updated>
    
    <content type="html"><![CDATA[<h1 id="报错提示"><a href="#报错提示" class="headerlink" title="报错提示"></a>报错提示</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Linking CXX static library ../archive_output_directory/libsql.a</span><br><span class="line">[ 92%] Built target sql</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>提示mysql 占用内存多，内存不够用或者CPU不够用。</p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><h2 id="升级配置（推荐方法）"><a href="#升级配置（推荐方法）" class="headerlink" title="升级配置（推荐方法）"></a>升级配置（推荐方法）</h2><p>将你的服务器配置升级到4C4G甚至更高（我的是2C2G跑炸的）</p><h2 id="取消参数"><a href="#取消参数" class="headerlink" title="取消参数"></a>取消参数</h2><p>如果你使用的是make -j4 &amp;&amp; make -j4 install , 建议降低线程甚至取消线程，使用默认一个线程编译安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;报错提示&quot;&gt;&lt;a href=&quot;#报错提示&quot; class=&quot;headerlink&quot; title=&quot;报错提示&quot;&gt;&lt;/a&gt;报错提示&lt;/h1&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Linking CXX static library ../archive_output_directory/libsql.a&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[ 92%] Built target sql&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;make: *** [all] Error 2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="踩坑" scheme="http://quail2333.github.io/tags/%E8%B8%A9%E5%9D%91/"/>
    
      <category term="MySQL" scheme="http://quail2333.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>初始化MySQL并修改密码</title>
    <link href="http://quail2333.github.io/2019/08/15/%E4%BF%AE%E6%94%B9MySQL%E5%AF%86%E7%A0%81/"/>
    <id>http://quail2333.github.io/2019/08/15/修改MySQL密码/</id>
    <published>2019-08-14T16:00:00.000Z</published>
    <updated>2019-08-15T02:42:13.414Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>由于MySQL5.7.X版本的安全限制，新安装的数据库是不允许我们使用<strong>mysqladmin -uroot password ‘初始化密码’ ‘新密码’</strong>进行更改密码操作的。所以我们第一次更改密码需要进入MySQL进行更改。<a id="more"></a></p><h1 id="第一次更改密码"><a href="#第一次更改密码" class="headerlink" title="第一次更改密码"></a>第一次更改密码</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql5/bin/mysqld --initialize --user=mysql --datadir=/data/mysql --</span><br><span class="line">basedir=/usr/local/mysql5</span><br></pre></td></tr></table></figure><p>使用这个命令进行初始化数据库，初始化完成后，可以在命令行的最后一行看到初始化生成的默认密码</p><p><img src="https://s2.ax1x.com/2019/08/12/ez241A.png" alt="ez241A.png"></p><p>执行下面的命令进入数据库命令行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p'1QlPyd(ki*dt'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.21</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span></span><br></pre></td></tr></table></figure><p>进入后输入下面的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span> alter user 'root'@localhost identified by 'Caianchun123.';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><p>修改成功后，我们需要刷新内存才能什么生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span> flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure><p>然后我们退出数据库，使用新密码重新登陆</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zecxmcsda0x83lfxjajZ home]# mysql -uroot -p'Caianchun123.'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 5</span><br><span class="line">Server version: 5.7.21 Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"></span><br><span class="line"><span class="meta">mysql&gt;</span></span><br></pre></td></tr></table></figure><p>密码修改成功。</p><h1 id="其他修改密码的方式"><a href="#其他修改密码的方式" class="headerlink" title="其他修改密码的方式"></a>其他修改密码的方式</h1><h2 id="修改mysql库字段"><a href="#修改mysql库字段" class="headerlink" title="修改mysql库字段"></a>修改mysql库字段</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span> use mysql;</span><br><span class="line"><span class="meta">mysql&gt;</span> update user set authentication_string=password("Jf123456.") where user='root';</span><br><span class="line"><span class="meta">mysql&gt;</span> flush privileges;</span><br></pre></td></tr></table></figure><h2 id="密码设置向导"><a href="#密码设置向导" class="headerlink" title="密码设置向导"></a>密码设置向导</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><h2 id="mysqladmin"><a href="#mysqladmin" class="headerlink" title="mysqladmin"></a>mysqladmin</h2><p>通过mysqladmin修改密码<strong>（但是第一次无法使用！）</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;由于MySQL5.7.X版本的安全限制，新安装的数据库是不允许我们使用&lt;strong&gt;mysqladmin -uroot password ‘初始化密码’ ‘新密码’&lt;/strong&gt;进行更改密码操作的。所以我们第一次更改密码需要进入MySQL进行更改。
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="MySQL" scheme="http://quail2333.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQL忘记密码怎么办</title>
    <link href="http://quail2333.github.io/2019/08/15/MySQL%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E6%80%8E%E4%B9%88%E5%8A%9E/"/>
    <id>http://quail2333.github.io/2019/08/15/MySQL忘记密码怎么办/</id>
    <published>2019-08-14T16:00:00.000Z</published>
    <updated>2019-08-15T03:43:11.505Z</updated>
    
    <content type="html"><![CDATA[<h1 id="场景模拟"><a href="#场景模拟" class="headerlink" title="场景模拟"></a>场景模拟</h1><p>今天突然想进MySQL瞅一眼，却发生了下面的事：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zecxmcsda0x83lfxjajz ~]# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/15/mAfho4.jpg" alt="mAfho4.jpg"></p><a id="more"></a>我记得是123啊？我再试一次<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zecxmcsda0x83lfxjajz ~]# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: YES)</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/15/mAf2LT.jpg" alt="mAf2LT.jpg"></p><p>正在我打算离家出走时，灵光乍现！</p><p><img src="https://s2.ax1x.com/2019/08/15/mAffwF.jpg" alt="mAffwF.jpg"></p><h1 id="开始操作"><a href="#开始操作" class="headerlink" title="开始操作"></a>开始操作</h1><ol><li>停止数据库服务</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mysqld</span><br></pre></td></tr></table></figure><ol start="2"><li>启动mysql进程使用密码跳过参数：<strong>skip-grant-tables</strong>，启动之后自动将MySQL进程挂到后台</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysqld_safe --user=mysql --skip-grant-tables &amp;</span><br></pre></td></tr></table></figure><ol start="3"><li>当出现以下内容，表示执行成功</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@iz2zecxmcsda0x83lfxjajz ~]# /usr/bin/mysqld_safe --user=mysql--skip-grant-tables &amp;</span><br><span class="line">[1] 29717</span><br><span class="line">[root@localhost ~]# 2019-05-29T13:55:05.468862Z mysqld_safe Logging to</span><br><span class="line">'/data/mysql/localhost.localdomain.err'.</span><br><span class="line">2019-05-29T13:55:05.505235Z mysqld_safe Starting mysqld daemon with databases from /data/mysql</span><br></pre></td></tr></table></figure><ol start="4"><li>直接mysql，回车登录</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql</span><br><span class="line">Welcome to the MySQL monitor. Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.21 Source distribution</span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"><span class="meta">mysql&gt;</span></span><br></pre></td></tr></table></figure><p>哇！被自己感动到哭……</p><p><img src="https://s2.ax1x.com/2019/08/15/mAfWeU.jpg" alt="mAfWeU.jpg"></p><ol start="5"><li>修改mysql库的字段，以修改密码</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>更换当前数据库</span><br><span class="line"><span class="meta">mysql&gt;</span> use mysql;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line">Database changed</span><br><span class="line"><span class="meta">#</span>更新字段，以修改密码</span><br><span class="line"><span class="meta">mysql&gt;</span> update user set authentication_string=password("Woshididi123.") where user='root';</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line">Rows matched: 1 Changed: 1 Warnings: 1</span><br><span class="line"><span class="meta">#</span>刷新权限</span><br><span class="line"><span class="meta">mysql&gt;</span> flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"><span class="meta">#</span>退出数据库</span><br><span class="line"><span class="meta">mysql&gt;</span> exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure><ol start="6"><li>因为我们默认是不能使用mysql直接登陆的，所以我们再执行mysql命令，发现mysql已经失效！</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql</span><br><span class="line">ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)</span><br></pre></td></tr></table></figure><ol start="7"><li>使用新密码重新登陆。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p'Woshididi123.'</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor. Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 4</span><br><span class="line">Server version: 5.7.21 Source distribution</span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line">Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</span><br><span class="line"><span class="meta">mysql&gt;</span></span><br></pre></td></tr></table></figure><p>！！！！！此刻的我已经无法用言语形容……</p><p><img src="https://s2.ax1x.com/2019/08/15/mAf5FJ.png" alt="mAf5FJ.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;场景模拟&quot;&gt;&lt;a href=&quot;#场景模拟&quot; class=&quot;headerlink&quot; title=&quot;场景模拟&quot;&gt;&lt;/a&gt;场景模拟&lt;/h1&gt;&lt;p&gt;今天突然想进MySQL瞅一眼，却发生了下面的事：&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@iz2zecxmcsda0x83lfxjajz ~]# mysql -uroot -p&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Enter password: &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: YES)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://s2.ax1x.com/2019/08/15/mAfho4.jpg&quot; alt=&quot;mAfho4.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="MySQL" scheme="http://quail2333.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 5.7编译安装（附脚本）</title>
    <link href="http://quail2333.github.io/2019/08/13/MySQL%205.7%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%EF%BC%88%E9%99%84%E8%84%9A%E6%9C%AC%EF%BC%89/"/>
    <id>http://quail2333.github.io/2019/08/13/MySQL 5.7编译安装（附脚本）/</id>
    <published>2019-08-12T16:00:00.000Z</published>
    <updated>2019-08-15T02:42:55.821Z</updated>
    
    <content type="html"><![CDATA[<h1 id="废话"><a href="#废话" class="headerlink" title="废话"></a>废话</h1><p>MySQL数据库安装方法有两种，一种是yum/rpm通过YUM源在线安装，另外一种是通过源码软件编译安装。<a id="more"></a></p><h1 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h1><h2 id="YUM安装方式"><a href="#YUM安装方式" class="headerlink" title="YUM安装方式"></a>YUM安装方式</h2><h3 id="CentOS-6-X"><a href="#CentOS-6-X" class="headerlink" title="CentOS 6.X"></a>CentOS 6.X</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mysql-server mysql-devel mysql-libs</span><br></pre></td></tr></table></figure><h3 id="CentOS-7-X"><a href="#CentOS-7-X" class="headerlink" title="CentOS 7.X"></a>CentOS 7.X</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mariadb-server mariadb mariadb-libs</span><br></pre></td></tr></table></figure><p>是不是巨简单！NO！NO！NO！yum方式安装普遍是安装的MySQL5.5，安装目录也就是普遍的/usr/local/mysql55。但我们为什么要使用源码安装还是安装的5.7版本呢？<strong>因为爱情……</strong></p><h2 id="编译安装方式"><a href="#编译安装方式" class="headerlink" title="编译安装方式"></a>编译安装方式</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul><li>OS：CentOS 7.4</li><li>内存：2G以上</li><li>mysql版本： 5.7.x</li></ul><p>因为1G的内存很大的概率会把虚拟机搞炸……别问我怎么知道的……</p><h3 id="安装包准备"><a href="#安装包准备" class="headerlink" title="安装包准备"></a>安装包准备</h3><ul><li>mysql-5.7.21.tar.gz。</li><li>cmake-3.15.2.tar.gz</li><li>boost_1_59_0.tar.gz</li></ul><h3 id="安装编译器cmake"><a href="#安装编译器cmake" class="headerlink" title="安装编译器cmake"></a>安装编译器cmake</h3><ol><li>解压cmake-3.15.2.tar.gz到指定目录</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxf /home/Laboratory_Installation_Package/cmake-3.15.2.tar.gz</span><br></pre></td></tr></table></figure><ol start="2"><li>预编译</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/Laboratory_Installation_Package/cmake-3.15.2/configure</span><br></pre></td></tr></table></figure><ol start="3"><li>编译安装一步到位</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/Laboratory_Installation_Package/cmake-3.15.2</span><br><span class="line">make -j4 &amp;&amp; make install</span><br></pre></td></tr></table></figure><ol start="4"><li>测试cmake是否安装成功</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -version</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/12/ezwwrQ.png" alt="ezwwrQ.png"></p><h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ncurses-devel perl autoconf automake zlib libxml libgcrypt libtool bison</span><br></pre></td></tr></table></figure><h3 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><h4 id="CMake预编译"><a href="#CMake预编译" class="headerlink" title="CMake预编译"></a>CMake预编译</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql5/ \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/tmp/mysql.sock \</span><br><span class="line">-DMYSQL_DATADIR=/data/mysql/ \</span><br><span class="line">-DSYSCONFDIR=/etc \</span><br><span class="line">-DMYSQL_USER=mysql \</span><br><span class="line">-DMYSQL_TCP_PORT=3306 \</span><br><span class="line">-DWITH_XTRADB_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_PARTITION_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_MYISAM_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_READLINE=1 \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DWITH_EXTRA_CHARSETS=1 \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DEXTRA_CHARSETS=all \</span><br><span class="line">-DWITH_BIG_TABLES=1 \</span><br><span class="line">-DWITH_DEBUG=0 \</span><br><span class="line">-DDOWNLOAD_BOOST=1 \</span><br><span class="line">-DWITH_BOOST=/usr/local/boost</span><br></pre></td></tr></table></figure><h4 id="编译安装MySQL"><a href="#编译安装MySQL" class="headerlink" title="编译安装MySQL"></a>编译安装MySQL</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>如果有条件，处理器个数：4+，内存大小：4G+，大家可以使用下面的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j4 &amp;&amp; make -j4 install</span><br></pre></td></tr></table></figure><h1 id="配置用户和数据目录"><a href="#配置用户和数据目录" class="headerlink" title="配置用户和数据目录"></a>配置用户和数据目录</h1><h2 id="配置用户和组"><a href="#配置用户和组" class="headerlink" title="配置用户和组"></a>配置用户和组</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql -r mysql</span><br></pre></td></tr></table></figure><h2 id="配置数据目录"><a href="#配置数据目录" class="headerlink" title="配置数据目录"></a>配置数据目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown mysql:mysql -R /usr/local/mysql5</span><br><span class="line">mkdir -p /data/mysql &amp;&amp; chown mysql:mysql -R /data/mysql/</span><br></pre></td></tr></table></figure><h1 id="修改或创建my-cnf"><a href="#修改或创建my-cnf" class="headerlink" title="修改或创建my.cnf"></a>修改或创建my.cnf</h1><p><strong>CentOS 7默认就存在一个my.cnf，但是这个是mariadb的配置文件，所以我们直接修改他一下</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">basedir = /usr/local/mysql5</span><br><span class="line">datadir = /data/mysql</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br></pre></td></tr></table></figure><p>这几个参数足够MySQL启动了换句话说，这是MySQL启动的必需参数，少一个MySQL都起不来。</p><h1 id="初始化MySQL"><a href="#初始化MySQL" class="headerlink" title="初始化MySQL"></a>初始化MySQL</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql5/bin/mysqld --initialize --user=mysql --datadir=/data/mysql --basedir=/usr/local/mysql5</span><br></pre></td></tr></table></figure><p><strong>初始化的功能就是在当前数据目录中创建基本MySQL的数据库管理表和账号。</strong></p><p><img src="https://s2.ax1x.com/2019/08/12/ezwran.png" alt="ezwran.png"></p><p>初始化完成后，最后一行会显示<strong>初始化后的数据库密码</strong>。</p><h1 id="配置命令连接和脚本启动"><a href="#配置命令连接和脚本启动" class="headerlink" title="配置命令连接和脚本启动"></a>配置命令连接和脚本启动</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/mysql5/bin/* /usr/bin/</span><br><span class="line">\cp support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">chmod +x /etc/init.d/mysqld</span><br><span class="line">chkconfig --add mysqld</span><br><span class="line">chkconfig --level 35 mysqld on</span><br></pre></td></tr></table></figure><h1 id="启动数据库服务"><a href="#启动数据库服务" class="headerlink" title="启动数据库服务"></a>启动数据库服务</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/12/ezw0bj.png" alt="ezw0bj.png"></p><h1 id="登陆MySQL"><a href="#登陆MySQL" class="headerlink" title="登陆MySQL"></a>登陆MySQL</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p'初始化生成的密码'</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/12/ezwDVs.png" alt="ezwDVs.png"></p><p><strong>至此，MySQL已经安装成功了！</strong></p><h1 id="一键配置安装脚本"><a href="#一键配置安装脚本" class="headerlink" title="一键配置安装脚本"></a>一键配置安装脚本</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"><span class="meta">#</span>Auto intsall MySQL and config</span><br><span class="line"><span class="meta">#</span>2019-08-12</span><br><span class="line"><span class="meta">#</span>by quail</span><br><span class="line"><span class="meta">#</span>ready 3 package:</span><br><span class="line"><span class="meta">#</span> mysql-5.7.21.tar.gz。</span><br><span class="line"><span class="meta">#</span> cmake-3.15.2.tar.gz</span><br><span class="line"><span class="meta">#</span> boost_1_59_0.tar.gz</span><br><span class="line"><span class="meta">#</span>send to /home/quail, then sh this script.</span><br><span class="line"><span class="meta">#</span>################################################</span><br><span class="line">Pdir=/home/quail</span><br><span class="line"><span class="meta">#</span>安装依赖包</span><br><span class="line">function devel()</span><br><span class="line">&#123;</span><br><span class="line">yum -y install ncurses-devel perl autoconf automake zlib libxml libgcrypt libtool bison</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span>安装cmake编译工具</span><br><span class="line">function cmake()</span><br><span class="line">&#123;</span><br><span class="line">tar zxf $Pdir/15.2.tar.gz</span><br><span class="line">cd $Pdir/cmake-3.15.2</span><br><span class="line">./configrue &amp;&amp; make -j4 &amp;&amp; make -j4 install</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span>安装boost第三方库</span><br><span class="line">function boost()</span><br><span class="line">&#123;</span><br><span class="line">tar zxf $Pdir/boost_1_59_0.tar.gz</span><br><span class="line">\cp -r $Pdir/boost_1_59_0/* /usr/local/boost/</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span>安装MySQL</span><br><span class="line">function mysql_install()</span><br><span class="line">&#123;</span><br><span class="line">cmake $Pdir/mysql-5.7.21/ -DCMAKE_INSTALL_PREFIX=/usr/local/mysql5/ -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DMYSQL_DATADIR=/data/mysql/ -DSYSCONFDIR=/etc -DMYSQL_USER=mysql -DMYSQL_TCP_PORT=3306 -DWITH_XTRADB_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_READLINE=1 -DENABLED_LOCAL_INFILE=1 -DWITH_EXTRA_CHARSETS=1 -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DEXTRA_CHARSETS=all -DWITH_BIG_TABLES=1 -DWITH_DEBUG=0 -DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/boost</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql -r mysql</span><br><span class="line">chown mysql:mysql -R /usr/local/mysql5</span><br><span class="line">mkdir -p /data/mysql &amp;&amp; chown mysql:mysql -R /data/mysql/</span><br><span class="line">echo -e '[mysqld]\nbasedir = /usr/local/mysql5\ndatadir = /data/mysql\nport = 3306\nsocket = /tmp/mysql.sock' &gt; /etc/my.cnf</span><br><span class="line">ln -s /usr/local/mysql5/bin/* /usr/bin/</span><br><span class="line">\cp support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line">chmod +x /etc/init.d/mysqld</span><br><span class="line">chkconfig --add mysqld</span><br><span class="line">chkconfig --level 35 mysqld on</span><br><span class="line">&#125;</span><br><span class="line">devel</span><br><span class="line">cmake</span><br><span class="line">boost</span><br><span class="line">mysql_install</span><br><span class="line">echo '+---------------------------+'</span><br><span class="line">echo '|         安装完成           |'</span><br><span class="line">echo '|        记得初始化哦！       |'</span><br><span class="line">echo '+---------------------------+'</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;废话&quot;&gt;&lt;a href=&quot;#废话&quot; class=&quot;headerlink&quot; title=&quot;废话&quot;&gt;&lt;/a&gt;废话&lt;/h1&gt;&lt;p&gt;MySQL数据库安装方法有两种，一种是yum/rpm通过YUM源在线安装，另外一种是通过源码软件编译安装。
    
    </summary>
    
    
      <category term="编译安装" scheme="http://quail2333.github.io/tags/%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85/"/>
    
      <category term="MySQL" scheme="http://quail2333.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Nginx防盗链配置案例配置</title>
    <link href="http://quail2333.github.io/2019/08/11/Nginx%E9%98%B2%E7%9B%97%E9%93%BE%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B%E9%85%8D%E7%BD%AE/"/>
    <id>http://quail2333.github.io/2019/08/11/Nginx防盗链配置案例配置/</id>
    <published>2019-08-10T16:00:00.000Z</published>
    <updated>2019-08-11T05:50:55.312Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h2 id="盗链"><a href="#盗链" class="headerlink" title="盗链"></a>盗链</h2><p>​        盗链是指服务提供商自己不提供服务的内容，通过技术手段绕过其它有利益的最终用户界面（如广告），直接在自己的网站上向最终用户提供其它服务提供商的服务内容，骗取最终用户的浏览和点击率。受益者不提供资源或提供很少的资源，而真正的服务提供商却得不到任何的收益。</p><p>​                                                                                                                    ——摘自百度百科<a id="more"></a></p><h2 id="盗链分类"><a href="#盗链分类" class="headerlink" title="盗链分类"></a>盗链分类</h2><h3 id="常规盗链"><a href="#常规盗链" class="headerlink" title="常规盗链"></a>常规盗链</h3><p>常规盗链比较初级，同时也比较常见，具有一定的针对性，只盗用某个或某些网站的链接。技术含量不高，实现也比较简单，只需要在自己的嵌入别人的链接即可。</p><h3 id="分布式盗链"><a href="#分布式盗链" class="headerlink" title="分布式盗链"></a>分布式盗链</h3><p>分布式盗链是盗链的一种新的形式，系统设计复杂，难度相对较大。这种盗链一般不针对某一个网站，互联网上任何一台机器都可能成为盗链的对象。服务提供商一般会在后台设置专门程序(Spider)在Internet上抓取有用的链接,<br>然后存储到自己的数据库中。而对于最终用户的每次访问，都将其转化为对已有数据库的查询，被查询到的URL<br>就是被盗链的对象。由于对文件的访问已经被浏览器屏蔽掉了，所以最终用户感觉不到所访问的链接是被盗取的链接。</p><h2 id="反盗链"><a href="#反盗链" class="headerlink" title="反盗链"></a>反盗链</h2><h3 id="原始方式"><a href="#原始方式" class="headerlink" title="原始方式"></a>原始方式</h3><p>不定期的更改文件或者目录的名称，是最原始的反盗链的方式，可以比较有效地防止盗链，这种方法一般工作量比较大。但是批量的文件改名是完全可以自动化的，而且也比较容易实现。在文件的更名过程中,  可能会有客户正在下载该文件，这样会导致正常的客户访问失败，尽管这个问题容易解决，但是也不能够忽视。</p><h3 id="限制引用页"><a href="#限制引用页" class="headerlink" title="限制引用页"></a>限制引用页</h3><p>这种防盗链原理是，服务器获取用户提交信息的网站地址，然后和真正的服务端的地址相比较，如果一致则表明是站内提交，或者为自己信任的站点提交，否则视为盗链。实现时可以使用HTTP_REFERER1 和htaccess 文件(需要启用mod_Rewrite)，结合正则表达式去匹配用户的每一个访问请求。对于每一个HTTP 请求, 服务器都要查找.htaccess 文件，增加了读取文件的次数，一定程度上降低了性能。另外，服务器打开这个功能，有比较多的限制。</p><h3 id="文件伪装"><a href="#文件伪装" class="headerlink" title="文件伪装"></a>文件伪装</h3><p>文件伪装是目前用得最多的一种反盗链技术，一般会结合服务器端动态脚本(PHP/JSP/ASP)。实际上用户请求的文件地址，只是一个经过伪装的脚本文件，这个脚本文件会对用户的请求作认证,一般会检查Session，Cookie 或HTTP_REFERER 作为判断是否为盗链的依据。而真实的文件实际隐藏在用户不能够访问的地方，只有用户通过验证以后才会返回给用户。</p><h3 id="加密认证"><a href="#加密认证" class="headerlink" title="加密认证"></a>加密认证</h3><p>这种反盗链方式，先从客户端获取用户信息，然后根据这个信息和用户请求的文件名字一起加密成字符串(Session  ID)作为身份验证。只有当认证成功以后，服务端才会把用户需要的文件传送给客户。一般我们会把加密的Session ID 作为URL  参数的一部分传递给服务器，由于这个Session ID 和用户的信息挂钩，所以别人就算是盗取了链接，该Session ID 也无法通过身份认证，从而达到反盗链的目的。这种方式对于分布式盗链非常有效。</p><h3 id="随机附加码"><a href="#随机附加码" class="headerlink" title="随机附加码"></a>随机附加码</h3><p>每次,在页面里生成一个附加码,并存在数据库里,和对应的图片相关,访问图片时和此附加码对比,相同则输出图片,否则输出404图片</p><h3 id="其它方法"><a href="#其它方法" class="headerlink" title="其它方法"></a>其它方法</h3><p>其它反盗链方式也有不少, 这里只列出一个大概思想作为参考：⑴ IIS 反盗链, 利用ISAPI_Rewrite,可作为Windows下反盗链的一个解决方案；⑵ 图片反盗链，在图片中加入水印，虽然盗链者可以达到目的，但是却也在为自己的网站做宣传。</p><h2 id="防盗链"><a href="#防盗链" class="headerlink" title="防盗链"></a>防盗链</h2><p>WEB应用防火墙通过实现URL级别的访问控制，对客户端请求进行检测，如果发现图片、文件等资源信息的HTTP请求来自于其它网站，则阻止盗链请求，节省因盗用资源链接而消耗的带宽和性能。</p><h1 id="防盗链实现案例"><a href="#防盗链实现案例" class="headerlink" title="防盗链实现案例"></a>防盗链实现案例</h1><h2 id="模拟盗链"><a href="#模拟盗链" class="headerlink" title="模拟盗链"></a>模拟盗链</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><ul><li><p>主站：192.168.249.103</p></li><li><p>盗链站：192.168.249.104</p></li><li><p>主站配置</p><ul><li>准备一张图片</li><li>并写一个页面引用他</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim test.html</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to quail's blog!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"20180513224039_tgfwu.png"</span> /&gt;</span></span><br></pre></td></tr></table></figure><ul><li>盗链站配置<ul><li>直接写一个盗链静态页面</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/html/daolian.html</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to DIDI's blog!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://www.test.com/20180513224039_tgfwu.png"</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h3><h4 id="主站"><a href="#主站" class="headerlink" title="主站"></a>主站</h4><p><img src="https://s2.ax1x.com/2019/08/11/ejWs0O.png" alt="ejWs0O.png"></p><h4 id="盗链站"><a href="#盗链站" class="headerlink" title="盗链站"></a>盗链站</h4><p><img src="https://s2.ax1x.com/2019/08/11/ejWrnK.png" alt="ejWrnK.png"></p><h2 id="通过配置Nginx实现防盗链"><a href="#通过配置Nginx实现防盗链" class="headerlink" title="通过配置Nginx实现防盗链"></a>通过配置Nginx实现防盗链</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>在server配置块中加入以下参数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location ~* \.(gif|jpg|png|swf|flv)$ &#123;</span><br><span class="line">            valid_referers none blocked  test.com *.test.com;</span><br><span class="line">            root   html;</span><br><span class="line">        if ($invalid_referer) &#123;</span><br><span class="line">            rewrite ^/ http://www.test.com/403.html;</span><br><span class="line">            return 403;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>保存后重新使用域名访问</p><p><img src="https://s2.ax1x.com/2019/08/11/ejWBX6.png" alt="ejWBX6.png"></p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>同样是修改Nginx配置文件的server段</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ~* \.(gif|jpg|png|swf|flv)$</span><br><span class="line">if ($host !=’*.test.com’) &#123;</span><br><span class="line">return 403；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再次访问盗链网站<br><img src="https://s2.ax1x.com/2019/08/11/ejW06x.png" alt="ejW06x.png"></p><h2 id="通过Nginx日志更直观的分析原因"><a href="#通过Nginx日志更直观的分析原因" class="headerlink" title="通过Nginx日志更直观的分析原因"></a>通过Nginx日志更直观的分析原因</h2><h3 id="清除日志"><a href="#清除日志" class="headerlink" title="清除日志"></a>清除日志</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span>/usr/local/nginx/logs/access.log</span><br></pre></td></tr></table></figure><h3 id="修改Nginx配置文件，在日志配置加入请求的参数"><a href="#修改Nginx配置文件，在日志配置加入请求的参数" class="headerlink" title="修改Nginx配置文件，在日志配置加入请求的参数"></a>修改Nginx配置文件，在日志配置加入请求的参数</h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; $invalid_referer&apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br></pre></td></tr></table></figure><h3 id="访问盗链网站，查看access-log"><a href="#访问盗链网站，查看access-log" class="headerlink" title="访问盗链网站，查看access.log"></a>访问盗链网站，查看access.log</h3><p><img src="https://s2.ax1x.com/2019/08/11/ejWy7D.png" alt="ejWy7D.png"></p><p>非主站的请求，Nginx会全部返回403</p><h1 id="Nginx防盗链参数详解"><a href="#Nginx防盗链参数详解" class="headerlink" title="Nginx防盗链参数详解"></a>Nginx防盗链参数详解</h1><ul><li><p>valid_referers表示可用的referers设置</p></li><li><p>none 表示没有referers，直接通过浏览器或者其他工具访问。</p></li><li><p>blocked表示有referers，但是被代理服务器或者防火墙隐藏；</p></li><li><p>jfedu.net 表示通过jfedu.net访问的referers；</p></li><li><p>*.test.com 表示通过*.test.com访问的referers，*表示任意host主机</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;h2 id=&quot;盗链&quot;&gt;&lt;a href=&quot;#盗链&quot; class=&quot;headerlink&quot; title=&quot;盗链&quot;&gt;&lt;/a&gt;盗链&lt;/h2&gt;&lt;p&gt;​        盗链是指服务提供商自己不提供服务的内容，通过技术手段绕过其它有利益的最终用户界面（如广告），直接在自己的网站上向最终用户提供其它服务提供商的服务内容，骗取最终用户的浏览和点击率。受益者不提供资源或提供很少的资源，而真正的服务提供商却得不到任何的收益。&lt;/p&gt;
&lt;p&gt;​                                                                                                                    ——摘自百度百科
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="Nginx" scheme="http://quail2333.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Linux 操作系统文件略解</title>
    <link href="http://quail2333.github.io/2019/08/11/Linux%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6%E7%95%A5%E8%A7%A3/"/>
    <id>http://quail2333.github.io/2019/08/11/Linux 操作系统文件略解/</id>
    <published>2019-08-10T16:00:00.000Z</published>
    <updated>2019-08-10T07:00:57.309Z</updated>
    
    <content type="html"><![CDATA[<h4 id="使用tree命令查看根目录的树结构"><a href="#使用tree命令查看根目录的树结构" class="headerlink" title="使用tree命令查看根目录的树结构"></a>使用tree命令查看根目录的树结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tree -L 1</span><br></pre></td></tr></table></figure><h4 id="如果没有tree命令，可以使用yum进行安装"><a href="#如果没有tree命令，可以使用yum进行安装" class="headerlink" title="如果没有tree命令，可以使用yum进行安装"></a>如果没有tree命令，可以使用yum进行安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install tree</span><br></pre></td></tr></table></figure><h4 id="执行命令后，即可看到根下一共有19个目录"><a href="#执行命令后，即可看到根下一共有19个目录" class="headerlink" title="执行命令后，即可看到根下一共有19个目录"></a>执行命令后，即可看到根下一共有19个目录<a id="more"></a></h4><p> <img src="https://s2.ax1x.com/2019/08/10/eOEs4e.png" alt="eOEs4e.png"></p><ul><li>.　　      当前目录</li><li>/                根目录</li><li>/bin           存放必要的命令;  软连接 /usr/bin</li><li>/boot   存放内核以及启动所需的文件;</li><li>/dev          存放硬件设备文件</li><li>/etc           存放系统配置文件</li><li>/home       普通用户的宿主目录，用户数据存放在其主目录中</li><li>/lib|lib64    存放必要的运行库</li><li>/mnt          存放临时的映射文件系统，通常用来挂载使用</li><li>/proc         存放存储进程和系统信息</li><li>/root          超级用户的主目录</li><li>/sbin         存放系统管理程序；软连接/usr/sbin</li><li>/tmp          存放临时文件</li><li>/usr           存放应用程序，命令程序文件、程序库、手册和其它文档</li><li>/var           系统默认日志存放目录</li></ul><p>简单来说Linux操作系统文件就分成这19个，如果你的Linux是debian的发行版本，系统目录会有所改变：</p><p><img src="https://s2.ax1x.com/2019/08/10/eOErND.png" alt="eOErND.png"></p><h4 id="比CentOS-7-4多了lastore、lost-found、media、opt、run、srv、sys这几个系统目录，那这几个系统目录是用来干嘛的呢？"><a href="#比CentOS-7-4多了lastore、lost-found、media、opt、run、srv、sys这几个系统目录，那这几个系统目录是用来干嘛的呢？" class="headerlink" title="比CentOS 7.4多了lastore、lost+found、media、opt、run、srv、sys这几个系统目录，那这几个系统目录是用来干嘛的呢？"></a>比CentOS 7.4多了lastore、lost+found、media、opt、run、srv、sys这几个系统目录，那这几个系统目录是用来干嘛的呢？</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/lastore              #支持Android应用和网页应用正常运行</span><br><span class="line">/lost+found           #存放问题文件、名字已被删除，数据还在使用的文件</span><br><span class="line">/media                #存放可移除介质</span><br><span class="line">/opt                  #存放附加软件包，是用户级的程序目录</span><br><span class="line">/run                  #存放系统运行时，所需要的文件</span><br><span class="line">/srv                  #服务启动后需要访问的数据目录</span><br><span class="line">/sys                  #存放核心系统硬件信息</span><br></pre></td></tr></table></figure><p>以上是个人对Linux操作系统文件的一点认识，还望大佬们指教。</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;使用tree命令查看根目录的树结构&quot;&gt;&lt;a href=&quot;#使用tree命令查看根目录的树结构&quot; class=&quot;headerlink&quot; title=&quot;使用tree命令查看根目录的树结构&quot;&gt;&lt;/a&gt;使用tree命令查看根目录的树结构&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tree -L 1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;如果没有tree命令，可以使用yum进行安装&quot;&gt;&lt;a href=&quot;#如果没有tree命令，可以使用yum进行安装&quot; class=&quot;headerlink&quot; title=&quot;如果没有tree命令，可以使用yum进行安装&quot;&gt;&lt;/a&gt;如果没有tree命令，可以使用yum进行安装&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum -y install tree&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;执行命令后，即可看到根下一共有19个目录&quot;&gt;&lt;a href=&quot;#执行命令后，即可看到根下一共有19个目录&quot; class=&quot;headerlink&quot; title=&quot;执行命令后，即可看到根下一共有19个目录&quot;&gt;&lt;/a&gt;执行命令后，即可看到根下一共有19个目录
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="Centos系统管理" scheme="http://quail2333.github.io/tags/Centos%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>lost+found目录有啥用？</title>
    <link href="http://quail2333.github.io/2019/08/11/lost+found%E7%9B%AE%E5%BD%95%E6%9C%89%E5%95%A5%E7%94%A8%EF%BC%9F/"/>
    <id>http://quail2333.github.io/2019/08/11/lost+found目录有啥用？/</id>
    <published>2019-08-10T16:00:00.000Z</published>
    <updated>2019-08-10T07:01:34.359Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Linux系统中根目录下或者新挂载的磁盘目录下有一个叫lost+found，它的作用是什么？</strong></p><p><img src="https://img2018.cnblogs.com/blog/1655141/201904/1655141-20190409010903646-851565896.png" alt="img"></p><p>​          <a id="more"></a>如果你运行fsck命令（文件系统检查和修复命令），它也许会找到一些数据碎片，这些文件碎片在硬盘中并没有引用。特别的，fsck也许能找到看起来是完整的文件，但是在系统中没有名字－一个inode但是不对应文件名。这个数据仍然占用硬盘空间，但是并不能通过正常方式访问。</p><p>​         lost+found目录的文件通常是未链接的文件（名字已经被删除），但是这些文件还被一些进程使用（数据没有删除），在突然关机时（内核panic或者突然断电）出现。这些文件系统会自动删除。</p><p>​        当因为软件或者硬件出现错误，导致文件系统不一致，也有可能把有问题的文件放到lost+found目录。它提供了恢复丢失文件的一种方法。</p><p>​       如果你不小心删除了lost+found目录，不能使用mkdir命令创建lost+found目录，应该使用mklost+found命令创建它。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /</span><br><span class="line">$ sudo mklost+found</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;Linux系统中根目录下或者新挂载的磁盘目录下有一个叫lost+found，它的作用是什么？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1655141/201904/1655141-20190409010903646-851565896.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;​
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="Centos系统管理" scheme="http://quail2333.github.io/tags/Centos%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Linux操作系统启动流程</title>
    <link href="http://quail2333.github.io/2019/08/11/Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/"/>
    <id>http://quail2333.github.io/2019/08/11/Linux操作系统启动流程/</id>
    <published>2019-08-10T16:00:00.000Z</published>
    <updated>2019-08-10T07:10:49.902Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><strong>理解Linux操作系统启动流程，能有助于后期在企业中更好的维护Linux服务器，能快速定位系统问题，进而解决问题。</strong></p><h1 id="Linux操作系统启动流程图"><a href="#Linux操作系统启动流程图" class="headerlink" title="Linux操作系统启动流程图"></a>Linux操作系统启动流程图</h1><p> <img src="https://s2.ax1x.com/2019/08/10/eOVHIO.png" alt="eOVHIO.png"></p><h1 id="启动流程详解"><a href="#启动流程详解" class="headerlink" title="启动流程详解"></a>启动流程详解</h1><h2 id="加载BIOS"><a href="#加载BIOS" class="headerlink" title="加载BIOS"></a>加载BIOS<a id="more"></a></h2><p>​          计算机电源加电质检，首先加载基本输入输出系统（Basic Input Output System，BIOS），BIOS中包含硬件CPU、内存、硬盘等相关信息，包含设备启动顺序信息、硬盘信息、内存信息、时钟信息、即插即用（Plug-and-Play，PNP）特性等。加载完BIOS信息，计算机将根据顺序进行启动。</p><h2 id="读取MBR"><a href="#读取MBR" class="headerlink" title="读取MBR"></a>读取MBR</h2><p>​        读取完BIOS信息，计算机将会查找BIOS所指定的硬盘MBR引导扇区，将其内容复制到0x7c00地址所在的物理内存中。被复制到物理内存的内容是Boot Loader，然后进行引导。</p><h2 id="GRUB引导"><a href="#GRUB引导" class="headerlink" title="GRUB引导"></a>GRUB引导</h2><p>​        GRUB启动引导器是计算机启动过程中运行的第一个软件程序，当计算机读取内存中的GRUB配置信息后，会根据其配置信息来启动硬盘中不同的操作系统。</p><h2 id="加载Kernel"><a href="#加载Kernel" class="headerlink" title="加载Kernel"></a>加载Kernel</h2><p>​        计算机读取内存映像，并进行解压缩操作，屏幕一般会输出“Uncompressing Linux”的提示，当解压缩内核完成后，屏幕输出“OK, booting the kernel”。系统将解压后的内核放置在内存之中，并调用start_kernel()函数来启动一系列的初始化函数并初始化各种设备，完成Linux核心环境的建立。</p><h2 id="设定Inittab运行等级"><a href="#设定Inittab运行等级" class="headerlink" title="设定Inittab运行等级"></a>设定Inittab运行等级</h2><p>​        内核加载完毕，会启动Linux操作系统第一个守护进程init，然后通过该进程读取/etc/inittab文件，/etc/inittab文件的作用是设定Linux的运行等级，Linux常见运行级别如下：</p><ul><li>0：关机模式</li><li>1：单用户模式</li><li>2：无网络支持的多用户模式</li><li>3：字符界面多用户模式</li><li>4：保留，未使用模式</li><li>5：图像界面多用户模式</li><li>6：重新引导系统，重启模式</li></ul><h2 id="加载rc-sysinit"><a href="#加载rc-sysinit" class="headerlink" title="加载rc.sysinit"></a>加载rc.sysinit</h2><p>​        读取完运行级别，Linux系统执行的第一个用户层文件/etc/rc.d/rc.sysinit，该文件功能包括：设定PATH运行变量、设定网络配置、启动swap分区、设定/proc、系统函数、配置Selinux等。</p><h2 id="加载内核模块"><a href="#加载内核模块" class="headerlink" title="加载内核模块"></a>加载内核模块</h2><p>​        读取/etc/modules.conf文件及/etc/modules.d目录下的文件来加载系统内核模块。该模块文件，可以后期添加或者修改及删除。</p><h2 id="启动运行级别程序"><a href="#启动运行级别程序" class="headerlink" title="启动运行级别程序"></a>启动运行级别程序</h2><p>​        根据之前读取的运行级别，操作系统会运行rc0.d到rc6.d中的相应的脚本程序，来完成相应的初始化工作和启动相应的服务。其中以S开头表示系统即将启动的程序，如果以K开头，则代表停止该服务。S和K后紧跟的数字为启动顺序编号。</p><p><img src="https://s2.ax1x.com/2019/08/10/eOZ8SJ.png" alt="eOZ8SJ.png"></p><p><img src="https://s2.ax1x.com/2019/08/10/eOZAzj.png" alt="eOZAzj.png"></p><p>上图为运行级别服务</p><h2 id="读取rc-local文件"><a href="#读取rc-local文件" class="headerlink" title="读取rc.local文件"></a>读取rc.local文件</h2><p>​        操作系统启动完相应服务之后，会读取执行/etc/rc.d/rc.local文件，可以将需要开机启动的任务加入到该文件末尾，系统会逐行去执行并启动相应命令。</p><p><img src="https://s2.ax1x.com/2019/08/10/eOZVQs.png" alt="eOZVQs.png"></p><p>开机运行加载文件</p><h2 id="执行-bin-login程序"><a href="#执行-bin-login程序" class="headerlink" title="执行/bin/login程序"></a>执行/bin/login程序</h2><p>​        执行/bin/login程序，启动到系统登录界面，操作系统等待用户输入用户名和密码，即可登录到Shell终端，如图3-7所示，输入用户名、密码即可登录Linux操作系统，至此Linux操作系统完整流程启动完毕。</p><p><img src="https://s2.ax1x.com/2019/08/10/eOZZyn.png" alt="eOZZyn.png"></p><p>系统登陆界面</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;理解Linux操作系统启动流程，能有助于后期在企业中更好的维护Linux服务器，能快速定位系统问题，进而解决问题。&lt;/strong&gt;&lt;/p&gt;
&lt;h1 id=&quot;Linux操作系统启动流程图&quot;&gt;&lt;a href=&quot;#Linux操作系统启动流程图&quot; class=&quot;headerlink&quot; title=&quot;Linux操作系统启动流程图&quot;&gt;&lt;/a&gt;Linux操作系统启动流程图&lt;/h1&gt;&lt;p&gt; &lt;img src=&quot;https://s2.ax1x.com/2019/08/10/eOVHIO.png&quot; alt=&quot;eOVHIO.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;启动流程详解&quot;&gt;&lt;a href=&quot;#启动流程详解&quot; class=&quot;headerlink&quot; title=&quot;启动流程详解&quot;&gt;&lt;/a&gt;启动流程详解&lt;/h1&gt;&lt;h2 id=&quot;加载BIOS&quot;&gt;&lt;a href=&quot;#加载BIOS&quot; class=&quot;headerlink&quot; title=&quot;加载BIOS&quot;&gt;&lt;/a&gt;加载BIOS
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="Centos系统管理" scheme="http://quail2333.github.io/tags/Centos%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7修改yum源为阿里源</title>
    <link href="http://quail2333.github.io/2019/08/11/CentOS%207%E4%BF%AE%E6%94%B9yum%E6%BA%90%E4%B8%BA%E9%98%BF%E9%87%8C%E6%BA%90/"/>
    <id>http://quail2333.github.io/2019/08/11/CentOS 7修改yum源为阿里源/</id>
    <published>2019-08-10T16:00:00.000Z</published>
    <updated>2019-08-10T06:50:12.116Z</updated>
    
    <content type="html"><![CDATA[<h2 id="手动更新"><a href="#手动更新" class="headerlink" title="手动更新"></a>手动更新</h2><p>1.备份本地源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 # mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo_bak</span><br></pre></td></tr></table></figure><p>2.获取阿里yum源配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 # wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><p>3.更新缓存<a id="more"></a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 # yum clean all</span><br><span class="line">2 # yum makecache</span><br></pre></td></tr></table></figure><p>4.更新软件包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 # yum -y update </span><br><span class="line">2 # yum -y upgrad</span><br></pre></td></tr></table></figure><h2 id="脚本更新"><a href="#脚本更新" class="headerlink" title="脚本更新"></a>脚本更新</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"><span class="meta">#</span>2019.07.09</span><br><span class="line"><span class="meta">#</span>by anchun for Centos 7.4</span><br><span class="line"><span class="meta">#</span>####################################</span><br><span class="line">function backup_repo()</span><br><span class="line">&#123;</span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo_bak</span><br><span class="line">&#125;</span><br><span class="line">function wget_repo()</span><br><span class="line">&#123;</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">&#125;</span><br><span class="line">function clean_cache()</span><br><span class="line">&#123;</span><br><span class="line">yum clean all</span><br><span class="line">&#125;</span><br><span class="line">function make_cache()</span><br><span class="line">&#123;</span><br><span class="line">yum makecache</span><br><span class="line">&#125;</span><br><span class="line">function update()</span><br><span class="line">&#123;</span><br><span class="line">yum -y update</span><br><span class="line">yum -y upgrade</span><br><span class="line">&#125;</span><br><span class="line">function epel()</span><br><span class="line">&#123;</span><br><span class="line">yum -y install epel-release</span><br><span class="line">&#125;</span><br><span class="line">PS3="Please select your want: "$i</span><br><span class="line">select i in Auto_update Backup Get_repo Clean Make_cache Update intsall_epel Exit </span><br><span class="line">do</span><br><span class="line">case $i in</span><br><span class="line">Auto_update)</span><br><span class="line">backup_repo</span><br><span class="line">wget_repo</span><br><span class="line">clean_cache</span><br><span class="line">make_cache</span><br><span class="line">epel</span><br><span class="line">update</span><br><span class="line">exit</span><br><span class="line">;;</span><br><span class="line">Backup)</span><br><span class="line">backup_repo</span><br><span class="line">;;</span><br><span class="line">Get_repo)</span><br><span class="line">wget_repo</span><br><span class="line">;;</span><br><span class="line">Clean)</span><br><span class="line">clean_cache</span><br><span class="line">;;</span><br><span class="line">Make_cache)</span><br><span class="line">make_cache</span><br><span class="line">;;</span><br><span class="line">Update)</span><br><span class="line">update</span><br><span class="line">;;</span><br><span class="line">intsall_epel)</span><br><span class="line">epel</span><br><span class="line">;;</span><br><span class="line">Exit)</span><br><span class="line">exit</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">esac</span><br><span class="line">done</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;手动更新&quot;&gt;&lt;a href=&quot;#手动更新&quot; class=&quot;headerlink&quot; title=&quot;手动更新&quot;&gt;&lt;/a&gt;手动更新&lt;/h2&gt;&lt;p&gt;1.备份本地源&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1 # mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo_bak&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;2.获取阿里yum源配置&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1 # wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;3.更新缓存
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="Centos系统管理" scheme="http://quail2333.github.io/tags/Centos%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>初识Jenkins持续集成平台</title>
    <link href="http://quail2333.github.io/2019/08/11/%E5%88%9D%E8%AF%86Jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%B9%B3%E5%8F%B0/"/>
    <id>http://quail2333.github.io/2019/08/11/初识Jenkins持续集成平台/</id>
    <published>2019-08-10T16:00:00.000Z</published>
    <updated>2019-08-10T06:12:28.758Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h2 id="为什么要引入Jenkins呢？"><a href="#为什么要引入Jenkins呢？" class="headerlink" title="为什么要引入Jenkins呢？"></a>为什么要引入Jenkins呢？</h2><p>​        随着企业的门户网站、业务系统不断的增加，通过运维人员手工的代码更新、部署非常吃力，消耗大量的人力成本，为了提高网站、业务系统的部署更新的效率，会引入自动化部署的平台：Hudson（收费版本）、Jenkins（开源免费）。<a id="more"></a></p><h2 id="通过Jenkins持续集成平台，能够实现哪些功能呢？简化哪些工作任务呢？"><a href="#通过Jenkins持续集成平台，能够实现哪些功能呢？简化哪些工作任务呢？" class="headerlink" title="通过Jenkins持续集成平台，能够实现哪些功能呢？简化哪些工作任务呢？"></a>通过Jenkins持续集成平台，能够实现哪些功能呢？简化哪些工作任务呢？</h2><p><img src="https://s2.ax1x.com/2019/08/09/eqRTds.png" alt="eqRTds.png"></p><ul><li><h3 id="开发人员"><a href="#开发人员" class="headerlink" title="开发人员"></a>开发人员</h3><p>默认开发人员编写代码、编译代码、打包程序代码、简单部署、发送运维人员部署等，使用Jenkins平台之后，开发人员只需开发代码即可，无需对代码进行编译、打包、部署等工作，只需要将网站源代码上传至SVN|GIT仓库即可。</p></li><li><h3 id="运维人员"><a href="#运维人员" class="headerlink" title="运维人员"></a>运维人员</h3><p>默认运维人员负责内网环境部署、外网环境网站备份、下载代码、更新代码、查看部署结果、回滚等工作，使用Jenkins平台之后，运维人员只需维护好Jenkins平台即可，无需部署网站、更新网站、回滚等工作。</p></li><li><h3 id="测试人员"><a href="#测试人员" class="headerlink" title="测试人员"></a>测试人员</h3><p>默认测试人员负责内网环境测试、手工测试、功能测试、性能测试，使用Jenkins平台之后，测试人员只需要编写测试脚本，将测试脚本传递给Jenkins平台，让Jenkins全自动执行并且测试。</p></li></ul><h2 id="Jenkins持续集成平台组件："><a href="#Jenkins持续集成平台组件：" class="headerlink" title="Jenkins持续集成平台组件："></a>Jenkins持续集成平台组件：</h2><ul><li>SVN|GIT文件代码仓库（文件服务器）；</li><li>部署Jenkins软件服务的服务器（平台）；</li><li>创建集成任务JOB、网站部署的流程（下载代码、编译代码、打包代码、部署代码、测试代码、发送部署邮件结果）；</li></ul><h1 id="构建Jenkins持续集成平台"><a href="#构建Jenkins持续集成平台" class="headerlink" title="构建Jenkins持续集成平台"></a>构建Jenkins持续集成平台</h1><h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><ol><li>Jenkins软件程序是基于JAVA语言开发的，要求运行Jenkins软件的底层Linux系统部署JAVA JDK（JVM虚拟机）。</li><li>Java部署：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tar xzf /home/quail/jdk1.8.0_131.tar.gz</span><br><span class="line">mkdir -p /usr/java/</span><br><span class="line">mv /home/quail/jdk1.8.0_131 /usr/java/</span><br><span class="line"><span class="meta">cat&gt;</span>&gt;/etc/profile&lt;&lt;EOF</span><br><span class="line"><span class="meta">&gt;</span> export JAVA_HOME=/usr/java/jdk1.8.0_131/</span><br><span class="line"><span class="meta">&gt;</span> export CLASSPATH=$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib</span><br><span class="line"><span class="meta">&gt;</span> export PATH=$PATH:/usr/java/jdk1.8.0_131/bin/</span><br><span class="line"><span class="meta">&gt;</span> EOF</span><br></pre></td></tr></table></figure><p>添加完成后，我们使用source命令重新载入一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>检查Java环境是否配置正确</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/09/eqf68P.png" alt="eqf68P.png"></p><p>ok！Java环境就绪，我们进行下一步</p><h2 id="安装Tomcat容器"><a href="#安装Tomcat容器" class="headerlink" title="安装Tomcat容器"></a>安装Tomcat容器</h2><h3 id="问号脸：为什么不直接使用jdk启动Jenkins程序呢？"><a href="#问号脸：为什么不直接使用jdk启动Jenkins程序呢？" class="headerlink" title="问号脸：为什么不直接使用jdk启动Jenkins程序呢？"></a>问号脸：为什么不直接使用jdk启动Jenkins程序呢？</h3><p>默认基于Java jdk确实可以直接启动Jenkins.war程序，但是此种方式不推荐（不方便管理），所以我们选择部署Tomcat WEB服务，通过Tomcat去发布和解析Jenkins程序。</p><h3 id="解压Tomcat压缩包"><a href="#解压Tomcat压缩包" class="headerlink" title="解压Tomcat压缩包"></a>解压Tomcat压缩包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf /home/quail/apache-tomcat-8.0.50.tar.gz</span><br><span class="line">mkdir -p /usr/local/tomcat</span><br><span class="line">\cp -r /home/quail/apache-tomcat-8.0.50/* /usr/local/tomcat/</span><br></pre></td></tr></table></figure><h3 id="释放Jenkins源码"><a href="#释放Jenkins源码" class="headerlink" title="释放Jenkins源码"></a>释放Jenkins源码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /usr/local/tomcat/webapps/*</span><br><span class="line">mkdir -p /usr/local/tomcat/webapps/ROOT</span><br><span class="line">mv /home/quail/jenkins.war /usr/local/tomcat/webapps/ROOT/</span><br><span class="line">cd /usr/local/tomcat/webapps/ROOT/</span><br><span class="line">jar -xf jenkins.war</span><br></pre></td></tr></table></figure><h3 id="启动Tomcat进程"><a href="#启动Tomcat进程" class="headerlink" title="启动Tomcat进程"></a>启动Tomcat进程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/tomcat/bin/startup.sh</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/09/eqh5LD.png" alt="eqh5LD.png"></p><h2 id="安装Jenkins持续集成平台"><a href="#安装Jenkins持续集成平台" class="headerlink" title="安装Jenkins持续集成平台"></a>安装Jenkins持续集成平台</h2><h3 id="通过浏览器访问当前服务器的8080端口"><a href="#通过浏览器访问当前服务器的8080端口" class="headerlink" title="通过浏览器访问当前服务器的8080端口"></a>通过浏览器访问当前服务器的8080端口</h3><p><img src="https://s2.ax1x.com/2019/08/09/eqhbFA.png" alt="eqhbFA.png"></p><h3 id="通过提示，找到密码并继续"><a href="#通过提示，找到密码并继续" class="headerlink" title="通过提示，找到密码并继续"></a>通过提示，找到密码并继续</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/.jenkins/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/09/eqh7od.png" alt="eqh7od.png"></p><p>通过一段时间的加载，就进入了安装界面</p><p><img src="https://s2.ax1x.com/2019/08/09/eqhqJI.png" alt="eqhqJI.png"></p><h3 id="安装选项"><a href="#安装选项" class="headerlink" title="安装选项"></a>安装选项</h3><p>如果我们选择“选择插件来安装”的话，会看到以下界面</p><p><img src="https://s2.ax1x.com/2019/08/09/eqhLWt.png" alt="eqhLWt.png"></p><p>可以看到一共有59个插件可供选择，但是咱们就选择默认安装就可以了</p><p><img src="https://s2.ax1x.com/2019/08/09/eqhTdH.png" alt="eqhTdH.png"></p><h3 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h3><p>由于咱们是自己做实验，所以使用admin用户即可</p><p><img src="https://s2.ax1x.com/2019/08/10/eq4iYn.png" alt="eq4iYn.png"></p><h3 id="实例配置"><a href="#实例配置" class="headerlink" title="实例配置"></a>实例配置</h3><p>咱们选择默认即可</p><p><img src="https://s2.ax1x.com/2019/08/10/eq4FWq.png" alt="eq4FWq.png"></p><h3 id="Jenkins持续集成平台构建完成"><a href="#Jenkins持续集成平台构建完成" class="headerlink" title="Jenkins持续集成平台构建完成"></a>Jenkins持续集成平台构建完成</h3><p><img src="https://s2.ax1x.com/2019/08/10/eq4AS0.png" alt="eq4AS0.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;h2 id=&quot;为什么要引入Jenkins呢？&quot;&gt;&lt;a href=&quot;#为什么要引入Jenkins呢？&quot; class=&quot;headerlink&quot; title=&quot;为什么要引入Jenkins呢？&quot;&gt;&lt;/a&gt;为什么要引入Jenkins呢？&lt;/h2&gt;&lt;p&gt;​        随着企业的门户网站、业务系统不断的增加，通过运维人员手工的代码更新、部署非常吃力，消耗大量的人力成本，为了提高网站、业务系统的部署更新的效率，会引入自动化部署的平台：Hudson（收费版本）、Jenkins（开源免费）。
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="Jenkins" scheme="http://quail2333.github.io/tags/Jenkins/"/>
    
  </entry>
  
  <entry>
    <title>如何修复被破坏的分区文件系统</title>
    <link href="http://quail2333.github.io/2019/08/11/%E5%A6%82%E4%BD%95%E4%BF%AE%E5%A4%8D%E8%A2%AB%E7%A0%B4%E5%9D%8F%E7%9A%84%E5%88%86%E5%8C%BA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"/>
    <id>http://quail2333.github.io/2019/08/11/如何修复被破坏的分区文件系统/</id>
    <published>2019-08-10T16:00:00.000Z</published>
    <updated>2019-08-10T06:46:37.809Z</updated>
    
    <content type="html"><![CDATA[<h2 id="·-准备阶段"><a href="#·-准备阶段" class="headerlink" title="· 准备阶段"></a>· 准备阶段</h2><p>由于条件原因，我只能在VMware虚拟机上进行模拟实验，开机的时候，发现sdb磁盘正常加载</p><p><img src="https://s2.ax1x.com/2019/08/10/eOF2j0.png" alt="eOF2j0.png"></p><p>然后通过lsblk命令查看挂载情况<a id="more"></a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lsblk</span><br><span class="line">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   20G  0 disk </span><br><span class="line">├─sda1            8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0   19G  0 part </span><br><span class="line">  ├─centos-root 253:0    0   17G  0 lvm  /</span><br><span class="line">  └─centos-swap 253:1    0    2G  0 lvm  [SWAP]</span><br><span class="line">sdb               8:16   0    5G  0 disk </span><br><span class="line">└─sdb1            8:17   0    5G  0 part /data</span><br><span class="line">sr0              11:0    1 1024M  0 rom</span><br></pre></td></tr></table></figure><p>进入/data目录，查看内容，并新建文件test，写入一句话：“this is test file.”，查看test内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /data/</span><br><span class="line">[root@localhost data]# ls</span><br><span class="line">lost+found</span><br><span class="line">[root@localhost data]# echo &quot;this is test file.&quot; &gt; test</span><br><span class="line">[root@localhost data]# ls</span><br><span class="line">lost+found  test</span><br><span class="line">[root@localhost data]# cat test </span><br><span class="line">this is test file.</span><br></pre></td></tr></table></figure><p>发现可以查看并正常写入文件，现在进入破坏阶段</p><h2 id="·-破坏阶段"><a href="#·-破坏阶段" class="headerlink" title="· 破坏阶段"></a>· 破坏阶段</h2><p>硬盘进行分区格式化（ext4）会创建硬盘内的文件存取系统表（superblock、block、inode信息），文件新建、文 件写入到分区内，正常存取block块。</p><p><strong>使用dd命令给硬盘写入文件，破坏硬盘内的文件存取系统表，给硬盘直接写入空文件。直接将文件写入给磁盘随机的扇 区里面。</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# dd if=/dev/zero of=/dev/sdb bs=1 count=20482048+0 records in</span><br><span class="line">2048+0 records out</span><br><span class="line">2048 bytes (2.0 kB) copied, 0.00410516 s, 499 kB/s</span><br></pre></td></tr></table></figure><p>破坏磁盘后，进入/data目录，写入文件test2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]# touch test2</span><br><span class="line">touch: cannot touch ‘test2’: Input/output error</span><br></pre></td></tr></table></figure><p>发现写入文件报错，reboot重启机器报错，输入密码直接进入单用户系统</p><p><img src="https://s2.ax1x.com/2019/08/10/eOFfBT.png" alt="eOFfBT.png"></p><h2 id="·-修复阶段"><a href="#·-修复阶段" class="headerlink" title="· 修复阶段"></a>· 修复阶段</h2><p>使用fsck修改文件系统</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhiost ~]# fsck -t ext4 -y /dev/sdb</span><br><span class="line">fsck from util-linux 2.23.2</span><br><span class="line">e2fsck 1.42.9(28-DEC-2013)</span><br><span class="line">ext2fs_open2:Bad magic number in super-block</span><br><span class="line">fsck.ext4:Superblock invalid,trying backup blocks...</span><br><span class="line">/dev/sdb was not cleanly unmounted, check forced.</span><br><span class="line">Pass 1 : Checking inodes,blocks,and sizes</span><br><span class="line">Pass 2 : Checking directory structure</span><br><span class="line">Pass 3 : Checking directory connectivity</span><br><span class="line">Pass 4 : Checking reference counts</span><br><span class="line">Pass 5 : Checking group summary information</span><br><span class="line">Free blocks count wrong for group #1 (31740, counted=31739).</span><br><span class="line">Fix? yes</span><br><span class="line"></span><br><span class="line">Free blocks count wrong (5116558, counted=5116557).</span><br><span class="line">Fix? yes</span><br><span class="line"></span><br><span class="line">Free inodes count wrong for group #0 (8181, counted=8180).</span><br><span class="line">Fix? yes</span><br><span class="line"></span><br><span class="line">Free inodes count wrong (1310709, counted=1310708).</span><br><span class="line">Fix? yes</span><br><span class="line"></span><br><span class="line">/dev/sdb : ***** FILE SYSTEM WAS MODIFIED *****</span><br><span class="line">/dev/sdb : 12/1310720 files (0.0% non-contiguous), 126323/5242880 blocks</span><br></pre></td></tr></table></figure><p>修复完成后reboot，重启系统。</p><p><img src="https://s2.ax1x.com/2019/08/10/eOFc3n.png" alt="eOFc3n.png"></p><p>重新进入系统，然后重新进行写入文件测试。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /data </span><br><span class="line">[root@localhost data]# ls </span><br><span class="line">lost+found test</span><br><span class="line">[root@localhost data]# cat test</span><br><span class="line">this is test file.</span><br><span class="line">[root@localhost deta]# echo &quot;this is test2 file.&quot; &gt; test2</span><br><span class="line">[root@localhost data]# ls </span><br><span class="line">lost+found test test2</span><br><span class="line">[root@localhost data]# cat test2</span><br><span class="line">this is test2 file.</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;·-准备阶段&quot;&gt;&lt;a href=&quot;#·-准备阶段&quot; class=&quot;headerlink&quot; title=&quot;· 准备阶段&quot;&gt;&lt;/a&gt;· 准备阶段&lt;/h2&gt;&lt;p&gt;由于条件原因，我只能在VMware虚拟机上进行模拟实验，开机的时候，发现sdb磁盘正常加载&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://s2.ax1x.com/2019/08/10/eOF2j0.png&quot; alt=&quot;eOF2j0.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;然后通过lsblk命令查看挂载情况
    
    </summary>
    
    
      <category term="基础" scheme="http://quail2333.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
      <category term="Centos系统管理" scheme="http://quail2333.github.io/tags/Centos%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Nginx Location匹配规则</title>
    <link href="http://quail2333.github.io/2019/08/09/Nginx%20Location%E5%8C%B9%E9%85%8D%E8%A7%84%E5%88%99/"/>
    <id>http://quail2333.github.io/2019/08/09/Nginx Location匹配规则/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-09T06:35:20.368Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>location是Nginx配置中的一个指令，用于访问的URL匹配，而在这个location中所配置的每个指令将会启动不同的 模块去完成相应的工作。<a id="more"></a></p><h1 id="理论部分"><a href="#理论部分" class="headerlink" title="理论部分"></a>理论部分</h1><h2 id="一、location语法："><a href="#一、location语法：" class="headerlink" title="一、location语法："></a>一、location语法：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location [=|~|~*|^~] uri &#123; … &#125;</span><br></pre></td></tr></table></figure><p>其中，方括号中的四种标识符是可选项，用来改变请求字符串和uri的匹配方式。uri是待匹配的请求字符串，可以是不包含正则的字符串，这种模式被称为“标准的uri”；也可以包含正则，这种模式被称为”正则uri”。例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ~ .*\.(php|php5)?$ &#123;</span><br><span class="line">　　root /var/www/html;</span><br><span class="line">　　……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二、四种可选标识符："><a href="#二、四种可选标识符：" class="headerlink" title="二、四种可选标识符："></a>二、四种可选标识符：</h2><table><thead><tr><th>标识符</th><th>描述</th></tr></thead><tbody><tr><td>=</td><td><strong>精确匹配：</strong>用于标准uri前，要求请求字符串和uri严格匹配。如果匹配成功就停止匹配，立即执行该location里面的请求。</td></tr><tr><td>~</td><td><strong>正则匹配：</strong>用于正则uri前，表示uri里面包含正则，并且区分大小写。</td></tr><tr><td>~*</td><td><strong>正则匹配：</strong>用于正则uri前，表示uri里面包含正则，不区分大小写。</td></tr><tr><td>^~</td><td><strong>非正则匹配；</strong>用于标准uri前，nginx服务器匹配到前缀最多的uri后就结束，该模式匹配成功后，不会使用正则匹配。</td></tr><tr><td>无</td><td><strong>普通匹配（最长字符匹配）；</strong>与location顺序无关，是按照匹配的长短来取匹配结果。若完全匹配，就停止匹配。</td></tr></tbody></table><h1 id="操作案例部分"><a href="#操作案例部分" class="headerlink" title="操作案例部分"></a>操作案例部分</h1><h2 id="一、环境准备"><a href="#一、环境准备" class="headerlink" title="一、环境准备"></a>一、环境准备</h2><p>为了方便验证各匹配标识符，我们借助第三方模块  echo模块进行操作。安装步骤向右看👉<a href="https://quail2333.github.io/2019/08/09/echo-nginx-module的安装、配置、使用/" target="_blank" rel="noopener">echo-nginx-module的安装、配置、使用</a></p><h2 id="二、匹配标识符案例"><a href="#二、匹配标识符案例" class="headerlink" title="二、匹配标识符案例"></a>二、匹配标识符案例</h2><h3 id="1-“-”精准匹配"><a href="#1-“-”精准匹配" class="headerlink" title="1. “=”精准匹配 "></a>1. “=”精准匹配<a href="https://www.cnblogs.com/quail2333/p/11181589.html" target="_blank" rel="noopener"> </a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location = /news/ &#123;</span><br><span class="line">            echo &quot;test1&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">[root@www quail]# curl 192.168.249.132/news/</span><br><span class="line">test1</span><br></pre></td></tr></table></figure><h2 id="2-“-”区分大小写正则匹配"><a href="#2-“-”区分大小写正则匹配" class="headerlink" title="2.  “~”区分大小写正则匹配"></a>2.  “~”区分大小写正则匹配</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.(html) &#123;</span><br><span class="line">    echo &apos;test2&apos;;</span><br><span class="line">&#125;</span><br><span class="line">location ~ \.(htmL) &#123;</span><br><span class="line">    echo &apos;test3&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@www quail]# curl 192.168.249.132/index.html</span><br><span class="line">test2</span><br><span class="line">[root@www quail]# curl 192.168.249.132/index.htmL</span><br><span class="line">test3</span><br></pre></td></tr></table></figure><h2 id="3-“-”不区分大小写的正则匹配"><a href="#3-“-”不区分大小写的正则匹配" class="headerlink" title="3. “~*”不区分大小写的正则匹配"></a>3. “~*”不区分大小写的正则匹配</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~* \.(html)&#123;</span><br><span class="line">            echo &apos;test4&apos;;</span><br><span class="line">&#125;</span><br><span class="line">[root@www quail]# curl 192.168.249.132/index.htmL</span><br><span class="line">test4</span><br><span class="line">[root@www quail]# curl 192.168.249.132/index.html</span><br><span class="line">test4</span><br></pre></td></tr></table></figure><h2 id="4-“-”不进行正则匹配的标准匹配，只匹配前缀"><a href="#4-“-”不进行正则匹配的标准匹配，只匹配前缀" class="headerlink" title="4. “^~”不进行正则匹配的标准匹配，只匹配前缀"></a>4. “^~”不进行正则匹配的标准匹配，只匹配前缀</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ^~ /index/ &#123;</span><br><span class="line">            echo &apos;test5&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@www quail]# curl 192.168.249.132/index/</span><br><span class="line">test5</span><br><span class="line">[root@www quail]# curl 192.168.249.132/index/heihei</span><br><span class="line">test5</span><br><span class="line">[root@www quail]# curl 192.168.249.132/index/asdnmkalsjd</span><br><span class="line">test5</span><br></pre></td></tr></table></figure><h2 id="5-普通匹配"><a href="#5-普通匹配" class="headerlink" title="5.普通匹配"></a>5.普通匹配</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">            echo &apos;test6&apos;;</span><br><span class="line">&#125;</span><br><span class="line">[root@www quail]# curl 192.168.249.132</span><br><span class="line">test6</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言：&quot;&gt;&lt;a href=&quot;#前言：&quot; class=&quot;headerlink&quot; title=&quot;前言：&quot;&gt;&lt;/a&gt;前言：&lt;/h1&gt;&lt;p&gt;location是Nginx配置中的一个指令，用于访问的URL匹配，而在这个location中所配置的每个指令将会启动不同的 模块去完成相应的工作。
    
    </summary>
    
    
      <category term="Nginx" scheme="http://quail2333.github.io/tags/Nginx/"/>
    
      <category term="Location" scheme="http://quail2333.github.io/tags/Location/"/>
    
  </entry>
  
  <entry>
    <title>echo-nginx-module的安装，配置，使用</title>
    <link href="http://quail2333.github.io/2019/08/09/echo-nginx-module%E7%9A%84%E5%AE%89%E8%A3%85%E3%80%81%E9%85%8D%E7%BD%AE%E3%80%81%E4%BD%BF%E7%94%A8/"/>
    <id>http://quail2333.github.io/2019/08/09/echo-nginx-module的安装、配置、使用/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-09T06:31:44.877Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、下载压缩包"><a href="#一、下载压缩包" class="headerlink" title="一、下载压缩包"></a>一、下载压缩包</h2><p>[root@www nginx-1.16.0]# wget <a href="https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz" target="_blank" rel="noopener">https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz</a></p><h2 id="二、解压v0-61-tar-gz"><a href="#二、解压v0-61-tar-gz" class="headerlink" title="二、解压v0.61.tar.gz"></a>二、解压v0.61.tar.gz</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@www nginx]# tar zxf v0.61.tar.gz</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="三、进入nginx-1-16-0目录，重新预编译-amp-amp-编译-amp-amp-安装"><a href="#三、进入nginx-1-16-0目录，重新预编译-amp-amp-编译-amp-amp-安装" class="headerlink" title="三、进入nginx-1.16.0目录，重新预编译 &amp;&amp; 编译 &amp;&amp; 安装"></a>三、进入nginx-1.16.0目录，重新预编译 &amp;&amp; 编译 &amp;&amp; 安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@www nginx-1.16.0]# ./configure --add-module=../echo-nginx-module &amp;&amp; make -j4 &amp;&amp; make install#--add-module:添加第三方模块#-j4：4个编译命令同时执行，提高效率</span><br></pre></td></tr></table></figure><h2 id="四、安装完成后，查看当前Nginx的详细信息"><a href="#四、安装完成后，查看当前Nginx的详细信息" class="headerlink" title="四、安装完成后，查看当前Nginx的详细信息"></a>四、安装完成后，查看当前Nginx的详细信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@www sbin]# ./nginx -V</span><br><span class="line">nginx version: nginx/1.16.0</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC) </span><br><span class="line">configure arguments: --add-module=../echo-nginx-module-0.61</span><br></pre></td></tr></table></figure><h2 id="五，重启Nginx，使模块生效"><a href="#五，重启Nginx，使模块生效" class="headerlink" title="五，重启Nginx，使模块生效"></a>五，重启Nginx，使模块生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@www sbin]# ./nginx -s stop</span><br><span class="line">[root@www sbin]# ./nginx</span><br><span class="line">[root@www sbin]# ps -ef|grep nginx</span><br><span class="line">root     130097      1  0 18:07 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">nobody   130098 130097  0 18:07 ?        00:00:00 nginx: worker process</span><br><span class="line">root     130100 129639  0 18:07 pts/2    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一、下载压缩包&quot;&gt;&lt;a href=&quot;#一、下载压缩包&quot; class=&quot;headerlink&quot; title=&quot;一、下载压缩包&quot;&gt;&lt;/a&gt;一、下载压缩包&lt;/h2&gt;&lt;p&gt;[root@www nginx-1.16.0]# wget &lt;a href=&quot;https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;二、解压v0-61-tar-gz&quot;&gt;&lt;a href=&quot;#二、解压v0-61-tar-gz&quot; class=&quot;headerlink&quot; title=&quot;二、解压v0.61.tar.gz&quot;&gt;&lt;/a&gt;二、解压v0.61.tar.gz&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@www nginx]# tar zxf v0.61.tar.gz&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Nginx" scheme="http://quail2333.github.io/tags/Nginx/"/>
    
      <category term="Location" scheme="http://quail2333.github.io/tags/Location/"/>
    
      <category term="plusing" scheme="http://quail2333.github.io/tags/plusing/"/>
    
  </entry>
  
  <entry>
    <title>针对discuz！丢失css解决办法</title>
    <link href="http://quail2333.github.io/2019/08/09/%E9%92%88%E5%AF%B9discuz%E4%B8%A2%E5%A4%B1css%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/"/>
    <id>http://quail2333.github.io/2019/08/09/针对discuz丢失css解决办法/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-09T06:16:16.892Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>上次我们搭建的discuz！论坛一直丢失css，界面丑的和cy弟弟一样，所以我们一定要修复一下。</p><h1 id="分析原因"><a href="#分析原因" class="headerlink" title="分析原因"></a>分析原因</h1><h2 id="缺失原因1—Nginx配置文件"><a href="#缺失原因1—Nginx配置文件" class="headerlink" title="缺失原因1—Nginx配置文件"></a>缺失原因1—Nginx配置文件</h2><h3 id="打开Nginx配置文件"><a href="#打开Nginx配置文件" class="headerlink" title="打开Nginx配置文件"></a>打开Nginx配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/09/ebiBNR.png" alt="ebiBNR.png"></p><a id="more"></a>原来我们只使用location匹配规则匹配了php结尾的页面，css属于静态文件。<p>所以我们在server配置块内增加一个新的location匹配规则</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~ .*\.(css|js|gif|jpg|jpeg|png|bmp|swf|ico)$ &#123;</span><br><span class="line">root /var/www/html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/09/ebidHJ.png" alt="ebidHJ.png"></p><p>保存后退出，检查配置文件的正确性以及重新载入配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -t</span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><p>重新访问首页，发现仍然不行！</p><p><img src="https://s2.ax1x.com/2019/08/09/ebiD41.png" alt="ebiD41.png"></p><h3 id="使用浏览器自带的开发者工具查看网络模块"><a href="#使用浏览器自带的开发者工具查看网络模块" class="headerlink" title="使用浏览器自带的开发者工具查看网络模块"></a>使用浏览器自带的开发者工具查看网络模块</h3><p><img src="https://s2.ax1x.com/2019/08/09/ebi0E9.png" alt="ebi0E9.png"></p><h3 id="nginx服务器的静态源码缺失"><a href="#nginx服务器的静态源码缺失" class="headerlink" title="nginx服务器的静态源码缺失"></a>nginx服务器的静态源码缺失</h3><p>发现css样式全是404，看来是没有文件，所以查看我们直接使用scp命令把后端服务器上的源码全部down到/var/www/html目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r 192.168.249.104:/var/www/html /var/www/html</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2019/08/09/ebiaB4.png" alt="ebiaB4.png"></p><p>使用tree命令查看data下的源码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">[root@www data]# tree /var/www/html/data/</span><br><span class="line">/var/www/html/data/</span><br><span class="line">├── addonmd5</span><br><span class="line">│   └── index.htm</span><br><span class="line">├── attachment</span><br><span class="line">│   ├── album</span><br><span class="line">│   │   └── index.htm</span><br><span class="line">│   ├── category</span><br><span class="line">│   ├── common</span><br><span class="line">│   │   └── index.htm</span><br><span class="line">│   ├── forum</span><br><span class="line">│   ├── group</span><br><span class="line">│   │   └── index.htm</span><br><span class="line">│   ├── index.htm</span><br><span class="line">│   ├── portal</span><br><span class="line">│   │   └── index.htm</span><br><span class="line">│   ├── profile</span><br><span class="line">│   │   └── index.htm</span><br><span class="line">│   ├── swfupload</span><br><span class="line">│   │   └── index.htm</span><br><span class="line">│   └── temp</span><br><span class="line">│       └── index.htm</span><br><span class="line">├── avatar</span><br><span class="line">│   └── index.htm</span><br><span class="line">├── backup_6443ff</span><br><span class="line">├── cache</span><br><span class="line">│   ├── common_postimg.js</span><br><span class="line">│   ├── common_smilies_var.js</span><br><span class="line">│   ├── index.htm</span><br><span class="line">│   ├── style_1_common.css</span><br><span class="line">│   ├── style_1_css_diy.css</span><br><span class="line">│   ├── style_1_css_space.css</span><br><span class="line">│   ├── style_1_editor.css</span><br><span class="line">│   ├── style_1_forum_calendar.css</span><br><span class="line">│   ├── style_1_forum_index.css</span><br><span class="line">│   ├── style_1_forum_moderator.css</span><br><span class="line">│   ├── style_1_module.css</span><br><span class="line">│   ├── style_1_rss.css</span><br><span class="line">│   ├── style_1_widthauto.css</span><br><span class="line">│   └── style_1_wysiwyg.css</span><br><span class="line">├── diy</span><br><span class="line">│   ├── index.htm</span><br><span class="line">│   └── template</span><br><span class="line">│       ├── default</span><br><span class="line">│       │   ├── group</span><br><span class="line">│       │   │   ├── index.htm</span><br><span class="line">│       │   │   └── index.htm.bak</span><br><span class="line">│       │   └── index.htm</span><br><span class="line">│       └── index.htm</span><br><span class="line">├── download</span><br><span class="line">│   └── index.htm</span><br><span class="line">├── index.htm</span><br><span class="line">├── install.lock</span><br><span class="line">├── ipdata</span><br><span class="line">│   ├── index.htm</span><br><span class="line">│   └── tinyipdata.dat</span><br><span class="line">├── log</span><br><span class="line">│   └── index.htm</span><br><span class="line">├── plugindata</span><br><span class="line">│   └── index.htm</span><br><span class="line">├── sendmail.lock</span><br><span class="line">├── stat_setting.xml</span><br><span class="line">├── sysdata</span><br><span class="line">│   ├── cache_domain.php</span><br><span class="line">│   ├── cache_pluginsetting.php</span><br><span class="line">│   └── index.html</span><br><span class="line">├── template</span><br><span class="line">│   ├── 1_1_common_footer_ajax.tpl.php</span><br><span class="line">│   ├── 1_1_common_footer.tpl.php</span><br><span class="line">│   ├── 1_1_common_header_ajax.tpl.php</span><br><span class="line">│   ├── 1_1_common_header_diynav.tpl.php</span><br><span class="line">│   ├── 1_1_common_header_forum_index.tpl.php</span><br><span class="line">│   ├── 1_1_common_header_userstatus.tpl.php</span><br><span class="line">│   ├── 1_1_common_showmessage.tpl.php</span><br><span class="line">│   ├── 1_1_member_login_simple.tpl.php</span><br><span class="line">│   ├── 1_1_member_login.tpl.php</span><br><span class="line">│   ├── 1_diy_forum_discuz.tpl.php</span><br><span class="line">│   └── index.htm</span><br><span class="line">└── threadcache</span><br><span class="line">    └── index.htm</span><br><span class="line"></span><br><span class="line">25 directories, 53 files</span><br></pre></td></tr></table></figure><p>然后回到浏览器重新访问首页</p><p><img src="https://s2.ax1x.com/2019/08/09/ebis9x.png" alt="ebis9x.png"></p><h1 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h1><ul><li><p>Nginx配置文件配置失误</p><ul><li>location匹配规则缺失</li><li>nginx.conf修改完成一定要重载配置文件</li></ul></li><li><p>Nginx实现动静分离</p><ul><li>动：转发到指定服务器处理请求</li><li>静：直接返回本地资源</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;上次我们搭建的discuz！论坛一直丢失css，界面丑的和cy弟弟一样，所以我们一定要修复一下。&lt;/p&gt;
&lt;h1 id=&quot;分析原因&quot;&gt;&lt;a href=&quot;#分析原因&quot; class=&quot;headerlink&quot; title=&quot;分析原因&quot;&gt;&lt;/a&gt;分析原因&lt;/h1&gt;&lt;h2 id=&quot;缺失原因1—Nginx配置文件&quot;&gt;&lt;a href=&quot;#缺失原因1—Nginx配置文件&quot; class=&quot;headerlink&quot; title=&quot;缺失原因1—Nginx配置文件&quot;&gt;&lt;/a&gt;缺失原因1—Nginx配置文件&lt;/h2&gt;&lt;h3 id=&quot;打开Nginx配置文件&quot;&gt;&lt;a href=&quot;#打开Nginx配置文件&quot; class=&quot;headerlink&quot; title=&quot;打开Nginx配置文件&quot;&gt;&lt;/a&gt;打开Nginx配置文件&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;vim /usr/local/nginx/conf/nginx.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;img src=&quot;https://s2.ax1x.com/2019/08/09/ebiBNR.png&quot; alt=&quot;ebiBNR.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Nginx" scheme="http://quail2333.github.io/tags/Nginx/"/>
    
      <category term="discuz!" scheme="http://quail2333.github.io/tags/discuz/"/>
    
      <category term="动静分离" scheme="http://quail2333.github.io/tags/%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB/"/>
    
  </entry>
  
  <entry>
    <title>Nginx Location匹配顺序</title>
    <link href="http://quail2333.github.io/2019/08/09/Nginx%20Location%E5%8C%B9%E9%85%8D%E9%A1%BA%E5%BA%8F/"/>
    <id>http://quail2333.github.io/2019/08/09/Nginx Location匹配顺序/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-09T06:42:51.060Z</updated>
    
    <content type="html"><![CDATA[<h1 id="理论部分"><a href="#理论部分" class="headerlink" title="理论部分"></a>理论部分</h1><h2 id="文字释义匹配规则如下："><a href="#文字释义匹配规则如下：" class="headerlink" title="文字释义匹配规则如下："></a>文字释义匹配规则如下：</h2><h3 id="略述"><a href="#略述" class="headerlink" title="略述"></a>略述</h3><ol><li><p>nginx服务器首先在server块的多个location块中搜索是否有标准的uri和请求字符串匹配。如果有多个标准uri可以匹配，就匹配其中匹配度最高的一个location。</p></li><li><p>然后，nginx在使用location块中，正则uri和请求字符串，进行匹配。如果正则匹配成功，则结束匹配，并使用这个location处理请求；如果正则匹配失败，则使用标准uri中，匹配度最高的location。<a id="more"></a></p></li></ol><h3 id="详细"><a href="#详细" class="headerlink" title="详细"></a>详细</h3><ol><li><p>如果有精确匹配，会先进行精确匹配，匹配成功，立刻返回结果。</p></li><li><p>普通匹配与顺序无关，因为按照匹配的长短来取匹配结果。</p></li><li><p>正则匹配与顺序有关，因为是从上往下匹配。(首先匹配，就结束解析过程)</p></li><li><p>在location中，有一种统配的location，所有的请求，都可以匹配</p></li></ol><h2 id="标识符匹配规则如下："><a href="#标识符匹配规则如下：" class="headerlink" title="标识符匹配规则如下："></a>标识符匹配规则如下：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(location = uri &#123;&#125;) &gt; (location 完整路径 &#123;&#125;) &gt; (location ^~ 路径 &#123;&#125;) &gt; (location ~,~* 正则顺序 &#123;&#125;) &gt; (location 部分起始路径 &#123;&#125;) &gt; (location / &#123;&#125;)</span><br></pre></td></tr></table></figure><h1 id="操作案例部分"><a href="#操作案例部分" class="headerlink" title="操作案例部分"></a>操作案例部分</h1><p>首先，我们把所有的规则写入nginx.conf，并重新读取nginx.conf然后开始实验，这次仍然借助echo-nginx-module进行，（echo-nginx-module配置过程向右看👉<a href="https://quail2333.github.io/2019/08/09/echo-nginx-module的安装、配置、使用/" target="_blank" rel="noopener">echo-nginx-module的安装、配置、使用</a>）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">location = /php.php &#123;</span><br><span class="line">            echo &apos;精确匹配&apos;;</span><br><span class="line">&#125;</span><br><span class="line">location ^~ /php/ &#123;</span><br><span class="line">            echo &apos;标准匹配，仅前缀&apos;;</span><br><span class="line">&#125;</span><br><span class="line">location ~ \.(php) &#123;</span><br><span class="line">            echo &apos;区分大小写，小写&apos;;</span><br><span class="line">&#125;</span><br><span class="line">location ~ \.(pHp) &#123;</span><br><span class="line">            echo &apos;区分大小写，大写&apos;;</span><br><span class="line">&#125;</span><br><span class="line">location ~* \.(php)$ &#123;</span><br><span class="line">            echo &apos;不区分大小写&apos;;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@www quail]# curl 192.168.249.132/php.php</span><br><span class="line">精确匹配</span><br><span class="line">[root@www quail]# curl 192.168.249.132/php/php.php</span><br><span class="line">标准匹配，仅前缀</span><br><span class="line">[root@www quail]# curl 192.168.249.132/pp.php</span><br><span class="line">区分大小写，小写</span><br><span class="line">[root@www quail]# curl 192.168.249.132/pp.pHp</span><br><span class="line">区分大小写，大写</span><br><span class="line">[root@www quail]# curl 192.168.249.132/php.pHP</span><br><span class="line">不区分大小写</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;理论部分&quot;&gt;&lt;a href=&quot;#理论部分&quot; class=&quot;headerlink&quot; title=&quot;理论部分&quot;&gt;&lt;/a&gt;理论部分&lt;/h1&gt;&lt;h2 id=&quot;文字释义匹配规则如下：&quot;&gt;&lt;a href=&quot;#文字释义匹配规则如下：&quot; class=&quot;headerlink&quot; title=&quot;文字释义匹配规则如下：&quot;&gt;&lt;/a&gt;文字释义匹配规则如下：&lt;/h2&gt;&lt;h3 id=&quot;略述&quot;&gt;&lt;a href=&quot;#略述&quot; class=&quot;headerlink&quot; title=&quot;略述&quot;&gt;&lt;/a&gt;略述&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;nginx服务器首先在server块的多个location块中搜索是否有标准的uri和请求字符串匹配。如果有多个标准uri可以匹配，就匹配其中匹配度最高的一个location。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;然后，nginx在使用location块中，正则uri和请求字符串，进行匹配。如果正则匹配成功，则结束匹配，并使用这个location处理请求；如果正则匹配失败，则使用标准uri中，匹配度最高的location。
    
    </summary>
    
    
      <category term="Nginx" scheme="http://quail2333.github.io/tags/Nginx/"/>
    
      <category term="Location" scheme="http://quail2333.github.io/tags/Location/"/>
    
  </entry>
  
  <entry>
    <title>Nginx的平滑升级记录---适用于编译安装的Nginx</title>
    <link href="http://quail2333.github.io/2019/08/09/Nginx%E7%9A%84%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7%E8%AE%B0%E5%BD%95---%E9%80%82%E7%94%A8%E4%BA%8E%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%E7%9A%84Nginx/"/>
    <id>http://quail2333.github.io/2019/08/09/Nginx的平滑升级记录---适用于编译安装的Nginx/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-09T06:44:54.014Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、查看自己的Nginx的版本号"><a href="#一、查看自己的Nginx的版本号" class="headerlink" title="一、查看自己的Nginx的版本号"></a>一、查看自己的Nginx的版本号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sbin]# cd /usr/local/nginx/sbin/</span><br><span class="line">[root@localhost sbin]# ls</span><br><span class="line">nginx</span><br><span class="line">[root@localhost sbin]# ./nginx -V</span><br><span class="line">nginx version: nginx/1.15.0</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC) </span><br><span class="line">configure arguments:</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="二、确定自己要升级的版本号，可以去官网找，或者确定要更新的版本号直接wget下载。"><a href="#二、确定自己要升级的版本号，可以去官网找，或者确定要更新的版本号直接wget下载。" class="headerlink" title="二、确定自己要升级的版本号，可以去官网找，或者确定要更新的版本号直接wget下载。"></a>二、确定自己要升级的版本号，可以去官网找，或者确定要更新的版本号直接wget下载。</h2><p><img src="https://img2018.cnblogs.com/blog/1655141/201907/1655141-20190712100526389-1671137579.png" alt="img"></p><p>这次咱们就升级稳定最新版1.16.0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost quail]# wget -c http://nginx.org/download/nginx-1.16.0.tar.gz</span><br><span class="line">--2019-07-12 10:11:12--  http://nginx.org/download/nginx-1.16.0.tar.gz</span><br><span class="line">Resolving nginx.org (nginx.org)... 62.210.92.35, 95.211.80.227, 2001:1af8:4060:a004:21::e3</span><br><span class="line">Connecting to nginx.org (nginx.org)|62.210.92.35|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 1032345 (1008K) [application/octet-stream]</span><br><span class="line">Saving to: ‘nginx-1.16.0.tar.gz’</span><br><span class="line"></span><br><span class="line">100%[===================================================================================================================&gt;] 1,032,345   8.08KB/s   in 86s    </span><br><span class="line"></span><br><span class="line">2019-07-12 10:12:39 (11.8 KB/s) - ‘nginx-1.16.0.tar.gz’ saved [1032345/1032345]</span><br></pre></td></tr></table></figure><h2 id="三、开始升平滑升级Nginx"><a href="#三、开始升平滑升级Nginx" class="headerlink" title="三、开始升平滑升级Nginx"></a>三、开始升平滑升级Nginx</h2><h3 id="1-解压nginx-1-16-0-tar-gz"><a href="#1-解压nginx-1-16-0-tar-gz" class="headerlink" title="1.解压nginx-1.16.0.tar.gz"></a>1.解压nginx-1.16.0.tar.gz</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost quail]# tar zxf nginx-1.16.0.tar.gz</span><br></pre></td></tr></table></figure><h3 id="2-进入nginx-1-16-0目录，进行预编译和编译操作"><a href="#2-进入nginx-1-16-0目录，进行预编译和编译操作" class="headerlink" title="2.进入nginx-1.16.0目录，进行预编译和编译操作"></a>2.进入nginx-1.16.0目录，进行预编译和编译操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.16.0]# ./configure --prefix=/usr/local/nginx &amp;&amp; make</span><br></pre></td></tr></table></figure><p>正常回显</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sed -e "s|%%PREFIX%%|/usr/local/nginx|" \</span><br><span class="line">    -e "s|%%PID_PATH%%|/usr/local/nginx/logs/nginx.pid|" \</span><br><span class="line">    -e "s|%%CONF_PATH%%|/usr/local/nginx/conf/nginx.conf|" \</span><br><span class="line">    -e "s|%%ERROR_LOG_PATH%%|/usr/local/nginx/logs/error.log|" \</span><br><span class="line">    &lt; man/nginx.8 &gt; objs/nginx.8</span><br><span class="line">make[1]: Leaving directory `/home/quail/nginx-1.16.0'</span><br></pre></td></tr></table></figure><h3 id="3-重命名执行文件"><a href="#3-重命名执行文件" class="headerlink" title="3.重命名执行文件"></a>3.重命名执行文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.16.0]# mv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.old</span><br></pre></td></tr></table></figure><h3 id="4-复制新编译的执行文件"><a href="#4-复制新编译的执行文件" class="headerlink" title="4.复制新编译的执行文件"></a>4.复制新编译的执行文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nginx-1.16.0]# cp objs/nginx /usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure><h3 id="5-平滑生效可执行文件"><a href="#5-平滑生效可执行文件" class="headerlink" title="5.平滑生效可执行文件"></a>5.平滑生效可执行文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# kill -USR2 `cat /usr/local/nginx/logs/nginx.pid` #USR2参数:在老的进程号的基础之上启动新的进程。</span><br></pre></td></tr></table></figure><h3 id="6-正常关闭老进程"><a href="#6-正常关闭老进程" class="headerlink" title="6.正常关闭老进程"></a>6.正常关闭老进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# kill -QUIT `cat /usr/local/nginx/logs/nginx.pid.oldbin`</span><br></pre></td></tr></table></figure><h2 id="至此，Nginx平滑升级完成。"><a href="#至此，Nginx平滑升级完成。" class="headerlink" title="至此，Nginx平滑升级完成。"></a>至此，Nginx平滑升级完成。</h2>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一、查看自己的Nginx的版本号&quot;&gt;&lt;a href=&quot;#一、查看自己的Nginx的版本号&quot; class=&quot;headerlink&quot; title=&quot;一、查看自己的Nginx的版本号&quot;&gt;&lt;/a&gt;一、查看自己的Nginx的版本号&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost sbin]# cd /usr/local/nginx/sbin/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost sbin]# ls&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost sbin]# ./nginx -V&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nginx version: nginx/1.15.0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;built by gcc 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;configure arguments:&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="Nginx" scheme="http://quail2333.github.io/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Python2.7更新pip：UnicodeDecodeError &#39;ascii&#39; codec can&#39;t decode byte 0xb7 in position 7 ordinal not in range(128)</title>
    <link href="http://quail2333.github.io/2019/08/09/Python2.7%E6%9B%B4%E6%96%B0pip%EF%BC%9AUnicodeDecodeError%20&#39;ascii&#39;%20codec%20can&#39;t%20decode%20byte%200xb7%20in%20position%207%20ordinal%20not%20in%20range(128)/"/>
    <id>http://quail2333.github.io/2019/08/09/Python2.7更新pip：UnicodeDecodeError &#39;ascii&#39; codec can&#39;t decode byte 0xb7 in position 7 ordinal not in range(128)/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-09T08:26:12.968Z</updated>
    
    <content type="html"><![CDATA[<h1 id="首先更新pip版本的时候出现。这是出现在python2-7-16出现的问题"><a href="#首先更新pip版本的时候出现。这是出现在python2-7-16出现的问题" class="headerlink" title="首先更新pip版本的时候出现。这是出现在python2.7.16出现的问题"></a>首先更新pip版本的时候出现。这是出现在python2.7.16出现的问题</h1><p><img src="https://s2.ax1x.com/2019/08/09/ebDGjI.png" alt="ebDGjI.png"></p><a id="more"></a><h1 id="进入你的pyhton目录下的Lib-mimetypes-py-打开它"><a href="#进入你的pyhton目录下的Lib-mimetypes-py-打开它" class="headerlink" title="进入你的pyhton目录下的Lib\mimetypes.py 打开它"></a>进入你的pyhton目录下的Lib\mimetypes.py 打开它</h1><h1 id><a href="#" class="headerlink" title></a><img src="https://s2.ax1x.com/2019/08/09/ebDYut.png" alt="ebDYut.png"></h1><h1 id="在import下面加入这代码"><a href="#在import下面加入这代码" class="headerlink" title="在import下面加入这代码"></a>在import下面加入这代码</h1><p> <img src="https://s2.ax1x.com/2019/08/09/ebDw4g.png" alt="ebDw4g.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if sys.getdefaultencoding() != &apos;gbk&apos;:</span><br><span class="line">    reload(sys)</span><br><span class="line">    sys.setdefaultencoding(&apos;gbk&apos;)</span><br><span class="line">#对准格式</span><br></pre></td></tr></table></figure><p><strong>4.保存退出后，重新执行更新pip命令</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install --upgrade pip</span><br></pre></td></tr></table></figure><p>问题成功解决。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;首先更新pip版本的时候出现。这是出现在python2-7-16出现的问题&quot;&gt;&lt;a href=&quot;#首先更新pip版本的时候出现。这是出现在python2-7-16出现的问题&quot; class=&quot;headerlink&quot; title=&quot;首先更新pip版本的时候出现。这是出现在python2.7.16出现的问题&quot;&gt;&lt;/a&gt;首先更新pip版本的时候出现。这是出现在python2.7.16出现的问题&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://s2.ax1x.com/2019/08/09/ebDGjI.png&quot; alt=&quot;ebDGjI.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://quail2333.github.io/tags/python/"/>
    
      <category term="pip" scheme="http://quail2333.github.io/tags/pip/"/>
    
      <category term="踩坑" scheme="http://quail2333.github.io/tags/%E8%B8%A9%E5%9D%91/"/>
    
  </entry>
  
  <entry>
    <title>Windows安装python3.x后pip list警告DEPRECATION:The default format will switch to columns in the future</title>
    <link href="http://quail2333.github.io/2019/08/09/Windows%E5%AE%89%E8%A3%85python3.x%E5%90%8Epiplist%E8%AD%A6%E5%91%8ADEPRECATIONTheefaultformatwillswitchtocolumnsinthefuture/"/>
    <id>http://quail2333.github.io/2019/08/09/Windows安装python3.x后piplist警告DEPRECATIONTheefaultformatwillswitchtocolumnsinthefuture/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-09T13:57:56.391Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言（凑字数专用）"><a href="#前言（凑字数专用）" class="headerlink" title="前言（凑字数专用）"></a>前言（凑字数专用）</h1><p>这个警告虽然不影响你的正常使用，但是每次都好几行红色警告，总是给人一种怪怪的感觉（当然不是FBI的警告了……），所以咱们还是把他解决掉~<a id="more"></a></p><p><img src="https://s2.ax1x.com/2019/08/09/ebBrm6.png" alt="ebBrm6.png"></p><p>网上好多解决办法都是Ubuntu的解决办法，下面虽然跟了windows的解决办法，但是仍然是~/pip，可能是本人孤陋寡闻，没听说过Windows的~目录</p><h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><ol><li><p>在C:\program DATA目录下，新建一个pip文件夹</p></li><li><p>进入刚才创建的pip文件夹，新建一个pip.ini配置文件</p></li><li><p>输入以下配置信息：</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[list]</span><br><span class="line">format=columns</span><br></pre></td></tr></table></figure><ol start="4"><li><p>保存退出</p></li><li><p>重新执行pip list发现警告解决。</p></li></ol><p><img src="https://s2.ax1x.com/2019/08/09/ebBf1A.png" alt="ebBf1A.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言（凑字数专用）&quot;&gt;&lt;a href=&quot;#前言（凑字数专用）&quot; class=&quot;headerlink&quot; title=&quot;前言（凑字数专用）&quot;&gt;&lt;/a&gt;前言（凑字数专用）&lt;/h1&gt;&lt;p&gt;这个警告虽然不影响你的正常使用，但是每次都好几行红色警告，总是给人一种怪怪的感觉（当然不是FBI的警告了……），所以咱们还是把他解决掉~
    
    </summary>
    
    
      <category term="python" scheme="http://quail2333.github.io/tags/python/"/>
    
      <category term="pip" scheme="http://quail2333.github.io/tags/pip/"/>
    
      <category term="踩坑" scheme="http://quail2333.github.io/tags/%E8%B8%A9%E5%9D%91/"/>
    
  </entry>
  
  <entry>
    <title>Nginx正向代理和反向代理</title>
    <link href="http://quail2333.github.io/2019/08/09/Nginx%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
    <id>http://quail2333.github.io/2019/08/09/Nginx正向代理和反向代理/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-09T03:31:29.436Z</updated>
    
    <content type="html"><![CDATA[<h2 id="关于代理"><a href="#关于代理" class="headerlink" title="关于代理"></a>关于代理</h2><p>说到代理，首先我们要明确一个概念，所谓代理就是一个代表、一个渠道；</p><p>此时就设计到两个角色，一个是被代理角色，一个是目标角色，被代理角色通过这个代理访问目标角色完成一些任务的过程称为代理操作过程；例如生活中的专卖店，客人到华为旗舰店买了一部华为P30 Pro，这个旗舰店就是代理，被代理角色就是华为厂商，目标角色就是用户。</p><h2 id="一、正向代理"><a href="#一、正向代理" class="headerlink" title="一、正向代理"></a>一、正向代理</h2><p>在如今的网络环境下，我们如果由于技术需要要去访问国外的某些网站，此时你会发现位于国外的某网站我们通过浏览器是没有办法访问的，此时大家可能都会用一个操作FQ进行访问，<a id="more"></a>FQ的方式主要是找到一个可以访问国外网站的代理服务器，我们将请求发送给代理服务器，代理服务器去访问国外的网站，然后将访问到的数据传递给我们。</p><p>上述这样的代理模式称为正向代理，正向代理最大的特点：</p><ol><li>客户端非常明确要访问的服务器地址；</li><li>服务器只清楚请求来自哪个代理服务器，而不清楚来自哪个具体的客户端；</li><li>正向代理模式屏蔽或者隐藏了真实客户端信息。</li></ol><p><img src="https://s2.ax1x.com/2019/08/09/eH4vtI.png" alt="eH4vtI.png"></p><h2 id="二、反向代理"><a href="#二、反向代理" class="headerlink" title="二、反向代理"></a>二、反向代理</h2><p>客户端给服务器发送的请求，nginx服务器接收到之后，按照一定的规则分发给了后端的业务处理服务器进行处理了。此时请求的来源也就是客户端是明确的，但是请求具体由哪台服务器处理的并不明确了，nginx扮演的就是一个反向代理角色。</p><p>反向代理，主要用于服务器集群分布式部署的情况下，反向代理隐藏了服务器的信息。</p><p><img src="https://s2.ax1x.com/2019/08/09/eH4xht.png" alt="eH4xht.png"></p><h2 id="三、应用场景"><a href="#三、应用场景" class="headerlink" title="三、应用场景"></a>三、应用场景</h2><p><img src="https://s2.ax1x.com/2019/08/09/eH5S9P.png" alt="eH5S9P.png"></p><h2 id="四、负载均衡"><a href="#四、负载均衡" class="headerlink" title="四、负载均衡"></a>四、负载均衡</h2><p>我们已经明确了所谓代理服务器的概念，那么接下来，nginx扮演了反向代理服务器的角色，它是以依据什么样的规则进行请求分发的呢？不用的项目应用场景，分发的规则是否可以控制呢？</p><p>这里提到的客户端发送的、nginx反向代理服务器接收到的请求数量，就是我们说的负载量</p><p>请求数量按照一定的规则进行分发到不同的服务器处理的规则，就是一种均衡规则</p><p>所以，将服务器接收到的请求按照规则分发的过程，称为负载均衡。</p><h3 id="负载均衡在实际项目操作过程中，有硬件负载均衡和软件负载均衡两种。"><a href="#负载均衡在实际项目操作过程中，有硬件负载均衡和软件负载均衡两种。" class="headerlink" title="负载均衡在实际项目操作过程中，有硬件负载均衡和软件负载均衡两种。"></a>负载均衡在实际项目操作过程中，有硬件负载均衡和软件负载均衡两种。</h3><p>硬件负载均衡也称为硬负载，如F5、NetScaler：</p><p>局限：相对造价昂贵成本较高，一套设备最起码得上百万，</p><p>优点：但是数据的稳定性安全性等等有非常好的保障，如中国移动中国联通这样的公司才会选择硬负载进行操作；</p><p>软件负载均衡也称为软负载，如LVS、Nginx、HAProxy：</p><p>更多的公司考虑到成本原因，会选择使用软件负载均衡，软件负载均衡是利用现有的技术结合主机硬件实现的一种消息队列分发机制</p><h3 id="nginx支持的负载均衡调度算法方式如下："><a href="#nginx支持的负载均衡调度算法方式如下：" class="headerlink" title="nginx支持的负载均衡调度算法方式如下："></a>nginx支持的负载均衡调度算法方式如下：</h3><ol><li>weight轮询（默认）：接收到的请求按照顺序逐一分配到不同的后端服务器，即使在使用过程中，某一台后端服务器宕机，nginx会自动将该服务器剔除出队列，请求受理情况不会受到任何影响。   这种方式下，可以给不同的后端服务器设置一个权重值（weight），用于调整不同的服务器上请求的分配率；权重数据越大，被分配到请求的几率越大；该权重值，主要是针对实际工作环境中不同的后端服务器硬件配置进行调整的。</li><li><strong>ip_hash（大部分使用此算法）：每个请求按照发起客户端的ip的hash结果进行匹配，这样的算法下一个固定ip地址的客户端总会访问到同一个后端服务器，这也在一定程度上解决了集群部署环境下session共享的问题。</strong></li><li>fair：智能调整调度算法，动态的根据后端服务器的请求处理到响应的时间进行均衡分配，响应时间短处理效率高的服务器分配到请求的概率高，响应时间长处理效率低的服务器分配到的请求少；结合了前两者的优点的一种调度算法。但是需要注意的是nginx默认不支持fair算法，如果要使用这种调度算法，请安装upstream_fair模块</li><li>url_hash（极少数使用此算法）：按照访问的url的hash结果分配请求，每个请求的url会指向后端固定的某个服务器，可以在nginx作为静态服务器的情况下提高缓存效率。同样要注意nginx默认不支持这种调度算法，要使用的话需要安装nginx的hash软件包</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;关于代理&quot;&gt;&lt;a href=&quot;#关于代理&quot; class=&quot;headerlink&quot; title=&quot;关于代理&quot;&gt;&lt;/a&gt;关于代理&lt;/h2&gt;&lt;p&gt;说到代理，首先我们要明确一个概念，所谓代理就是一个代表、一个渠道；&lt;/p&gt;
&lt;p&gt;此时就设计到两个角色，一个是被代理角色，一个是目标角色，被代理角色通过这个代理访问目标角色完成一些任务的过程称为代理操作过程；例如生活中的专卖店，客人到华为旗舰店买了一部华为P30 Pro，这个旗舰店就是代理，被代理角色就是华为厂商，目标角色就是用户。&lt;/p&gt;
&lt;h2 id=&quot;一、正向代理&quot;&gt;&lt;a href=&quot;#一、正向代理&quot; class=&quot;headerlink&quot; title=&quot;一、正向代理&quot;&gt;&lt;/a&gt;一、正向代理&lt;/h2&gt;&lt;p&gt;在如今的网络环境下，我们如果由于技术需要要去访问国外的某些网站，此时你会发现位于国外的某网站我们通过浏览器是没有办法访问的，此时大家可能都会用一个操作FQ进行访问，
    
    </summary>
    
    
      <category term="Nginx" scheme="http://quail2333.github.io/tags/Nginx/"/>
    
      <category term="反向代理" scheme="http://quail2333.github.io/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Nginx代理服务器搭建discuz</title>
    <link href="http://quail2333.github.io/2019/08/09/Nginx%E6%90%AD%E5%BB%BADiscuz!/"/>
    <id>http://quail2333.github.io/2019/08/09/Nginx搭建Discuz!/</id>
    <published>2019-08-08T16:00:00.000Z</published>
    <updated>2019-08-09T03:29:23.029Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><ul><li>Nginx代理服务器</li><li>PHP后端服务器</li><li>数据库服务器</li><li>Discuz_X3.2_SC_UTF8.zip<a id="more"></a></li></ul><h1 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h1><p><img src="https://i.loli.net/2019/08/09/TKzQBXRUMd6hCcm.jpg" alt="架构图.jpg"></p><h1 id="开始搭建Discuz！论坛"><a href="#开始搭建Discuz！论坛" class="headerlink" title="开始搭建Discuz！论坛"></a>开始搭建Discuz！论坛</h1><h2 id="Nginx代理服务器"><a href="#Nginx代理服务器" class="headerlink" title="Nginx代理服务器"></a>Nginx代理服务器</h2><h3 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h3><p><strong><a href="https://quail2333.github.io/2019/08/08/Nginx编译安装(附脚本)/" target="_blank" rel="noopener">Nginx编译安装请戳我！</a></strong></p><h3 id="启动Nginx"><a href="#启动Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure><p>启动失败的话查看日志，先进行排错，pkill相关进程，在执行启动命令</p><h3 id="修改Nginx配置文件如下"><a href="#修改Nginx配置文件如下" class="headerlink" title="修改Nginx配置文件如下"></a>修改Nginx配置文件如下</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  www.test.com;</span><br><span class="line">        #error_page   500 502 503 504  /50x.html;</span><br><span class="line">root /var/www/html;</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">    root /var/www/html;</span><br><span class="line">    fastcgi_pass   192.168.249.104:9000;</span><br><span class="line">            fastcgi_index  index.php;</span><br><span class="line">            fastcgi_param  SCRIPT_FILENAME /var/www/html$fastcgi_script_name;</span><br><span class="line">            include fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改完成后检查配置文件是否正确</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -t</span><br></pre></td></tr></table></figure><p>无误后重新载入配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure><h2 id="PHP后端服务器"><a href="#PHP后端服务器" class="headerlink" title="PHP后端服务器"></a>PHP后端服务器</h2><h3 id="安装PHP"><a href="#安装PHP" class="headerlink" title="安装PHP"></a>安装PHP</h3><p><strong><a href="https://quail2333.github.io/2019/08/08/PHP-5.6.8编译安装(附脚本)/" target="_blank" rel="noopener">PHP编译安装请戳我！</a></strong></p><h3 id="启动php-fpm进程"><a href="#启动php-fpm进程" class="headerlink" title="启动php-fpm进程"></a>启动php-fpm进程</h3><p><strong><a href="https://quail2333.github.io/2019/08/08/PHP-5.6.8编译安装(附脚本)/" target="_blank" rel="noopener">启动php-fpm进程也戳我！</a></strong></p><h3 id="修改php-fpm进程配置文件"><a href="#修改php-fpm进程配置文件" class="headerlink" title="修改php-fpm进程配置文件"></a>修改php-fpm进程配置文件</h3><p>因为php-fpm默认监听127.0.0.1：9000，别的服务器请求会被拒之门外，所以我们通过下面的命令修改配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i 's#listen = 127.0.0.1:9000#listen = 192.168.249.104:9000#g' /usr/local/php/etc/php-fpm.conf</span><br></pre></td></tr></table></figure><p>然后重启php-fpm进程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart php-fpm</span><br></pre></td></tr></table></figure><h3 id="释放discuz源码"><a href="#释放discuz源码" class="headerlink" title="释放discuz源码"></a>释放discuz源码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp -r 192.168.249.103:/home/quail/Discuz_X3.2_SC_UTF8.zip /var/www/html</span><br><span class="line">unzip /var/www/html/Discuz_X3.2_SC_UTF8.zip</span><br><span class="line">rm -f /var/www/html/Discuz_X3.2_SC_UTF8.zip</span><br></pre></td></tr></table></figure><h3 id="修改discuz源码权限"><a href="#修改discuz源码权限" class="headerlink" title="修改discuz源码权限"></a>修改discuz源码权限</h3><p>网上很多教程都是给777，我建议能少给就少给，我给的755</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 -R /var/www/html</span><br></pre></td></tr></table></figure><h2 id="数据库服务器"><a href="#数据库服务器" class="headerlink" title="数据库服务器"></a>数据库服务器</h2><h3 id="安装mariadb服务"><a href="#安装mariadb服务" class="headerlink" title="安装mariadb服务"></a>安装mariadb服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mariadb mariadb-server mysql-devel</span><br></pre></td></tr></table></figure><h3 id="启动mariadb"><a href="#启动mariadb" class="headerlink" title="启动mariadb"></a>启动mariadb</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mariadb</span><br></pre></td></tr></table></figure><h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><ol><li>执行初始化命令</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><ol start="2"><li>默认密码为空，所以直接回车</li><li>提示让你输入新密码并确认</li><li>无脑回车，直到退出为止</li></ol><h3 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h3><h4 id="进入数据库"><a href="#进入数据库" class="headerlink" title="进入数据库"></a>进入数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p 123456#123456是我设置的数据库密码</span><br></pre></td></tr></table></figure><h4 id="新建discuz！数据库"><a href="#新建discuz！数据库" class="headerlink" title="新建discuz！数据库"></a>新建discuz！数据库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database discuz;</span><br></pre></td></tr></table></figure><h4 id="退出数据库"><a href="#退出数据库" class="headerlink" title="退出数据库"></a>退出数据库</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit;</span><br></pre></td></tr></table></figure><h2 id="打开浏览器，访问Nginx服务器的IP"><a href="#打开浏览器，访问Nginx服务器的IP" class="headerlink" title="打开浏览器，访问Nginx服务器的IP"></a>打开浏览器，访问Nginx服务器的IP</h2><p><img src="https://i.loli.net/2019/08/09/NIDQrJCanOxUS2M.png" alt="1565320030037.png"></p><h3 id="同意后进入权限检查，全是可写，下一步"><a href="#同意后进入权限检查，全是可写，下一步" class="headerlink" title="同意后进入权限检查，全是可写，下一步"></a>同意后进入权限检查，全是可写，下一步</h3><h3 id="进入数据库配置界面"><a href="#进入数据库配置界面" class="headerlink" title="进入数据库配置界面"></a>进入数据库配置界面</h3><p><img src="https://s2.ax1x.com/2019/08/09/eH4Df0.png" alt="eH4Df0.png"></p><p>输入完成后，下一步。</p><p><img src="https://s2.ax1x.com/2019/08/09/eH42m4.png" alt="eH42m4.png"></p><p>哎呦我去？！这……原来远程数据库需要授权才能链接，进入数据库服务器的mariadb，执行以下命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant all PRIVILEGES on discuz.* to root@'192.168.249.104'  identified by '123456';</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><p>重新点击下一步，已经正在安装了，安装完成后，点击访问即可。</p><p><img src="https://i.loli.net/2019/08/09/oBn3ePHIpd2wRig.png" alt="1565320752780.png"></p><h3 id="看看咱们的新首页-哎呦我去！"><a href="#看看咱们的新首页-哎呦我去！" class="headerlink" title="看看咱们的新首页~哎呦我去！"></a>看看咱们的新首页~哎呦我去！</h3><p><img src="https://i.loli.net/2019/08/09/hQqBFjDGPyK5RVp.png" alt="1565320881901.png"></p><p>Ok啦，新论坛搭建完成，首页一看就是CSS没有加载，这是因为Nginx只转发动态请求，下次我们更新动静分离，实现咱们的discuz论坛！</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;环境准备&quot;&gt;&lt;a href=&quot;#环境准备&quot; class=&quot;headerlink&quot; title=&quot;环境准备&quot;&gt;&lt;/a&gt;环境准备&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;Nginx代理服务器&lt;/li&gt;
&lt;li&gt;PHP后端服务器&lt;/li&gt;
&lt;li&gt;数据库服务器&lt;/li&gt;
&lt;li&gt;Discuz_X3.2_SC_UTF8.zip
    
    </summary>
    
    
      <category term="Nginx" scheme="http://quail2333.github.io/tags/Nginx/"/>
    
      <category term="PHP" scheme="http://quail2333.github.io/tags/PHP/"/>
    
      <category term="discuz!" scheme="http://quail2333.github.io/tags/discuz/"/>
    
  </entry>
  
</feed>
